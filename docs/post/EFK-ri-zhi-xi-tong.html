<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="//cdn.staticfile.net/Primer/21.0.7/primer.css" rel="stylesheet" />
    <link rel="icon" href="https://img.witter.top/file/b037878209903b7d5bb17.jpg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="# EFK日志告警系统

**注：现在新版本elastic stack已经支持将kafka作为输出和输入的目标**

当日志不是结构化数据：*.log->filebeat->kafka->logstash->elasticsearch

当日志是结构化数据：*.log->filebeat->kafka->filebeat->elasticsearch

区别在于是否需要logstash进行日志的过滤和结构化；

## 结构化日志

**连接示例配置文件**

### filebeat 1

> 此filebeat实例为日志采集端，即kafka生产者，可以有多个实例进行采集

```yaml
filebeat.inputs:
- type: filestream #新版本常用文件流输入方式
  id: my-filestream-id #每个文件流输入必须有一个唯一的 ID。">
<meta property="og:title" content="EFK日志系统">
<meta property="og:description" content="# EFK日志告警系统

**注：现在新版本elastic stack已经支持将kafka作为输出和输入的目标**

当日志不是结构化数据：*.log->filebeat->kafka->logstash->elasticsearch

当日志是结构化数据：*.log->filebeat->kafka->filebeat->elasticsearch

区别在于是否需要logstash进行日志的过滤和结构化；

## 结构化日志

**连接示例配置文件**

### filebeat 1

> 此filebeat实例为日志采集端，即kafka生产者，可以有多个实例进行采集

```yaml
filebeat.inputs:
- type: filestream #新版本常用文件流输入方式
  id: my-filestream-id #每个文件流输入必须有一个唯一的 ID。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.witter.top/post/EFK-ri-zhi-xi-tong.html">
<meta property="og:image" content="https://img.witter.top/file/b037878209903b7d5bb17.jpg">
<title>EFK日志系统</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />

</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">EFK日志系统</h1>
<div class="title-right">
    <a href="https://blog.witter.top" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/ljwtorch/ljwtorch.github.io/issues/4" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><h1>EFK日志告警系统</h1>
<p><strong>注：现在新版本elastic stack已经支持将kafka作为输出和输入的目标</strong></p>
<p>当日志不是结构化数据：*.log-&gt;filebeat-&gt;kafka-&gt;logstash-&gt;elasticsearch</p>
<p>当日志是结构化数据：*.log-&gt;filebeat-&gt;kafka-&gt;filebeat-&gt;elasticsearch</p>
<p>区别在于是否需要logstash进行日志的过滤和结构化；</p>
<h2>结构化日志</h2>
<p><strong>连接示例配置文件</strong></p>
<h3>filebeat 1</h3>
<blockquote>
<p>此filebeat实例为日志采集端，即kafka生产者，可以有多个实例进行采集</p>
</blockquote>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">filebeat.inputs</span>:
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span><span class="pl-c"><span class="pl-c">#</span>新版本常用文件流输入方式</span>
  <span class="pl-ent">id</span>: <span class="pl-s">my-filestream-id </span><span class="pl-c"><span class="pl-c">#</span>每个文件流输入必须有一个唯一的 ID。省略或更改文件流 ID 可能会导致数据重复。如果没有唯一的 ID，filestream 无法正确跟踪文件的状态。</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s">/var/log/messages</span>
    - <span class="pl-s">/var/log/*.log</span>
    
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span>
  <span class="pl-ent">id</span>: <span class="pl-s">apache-filestream-id</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s"><span class="pl-pds">"</span>/var/log/apache2/*<span class="pl-pds">"</span></span>
  <span class="pl-ent">fields</span>:
    <span class="pl-ent">apache</span>: <span class="pl-s">true </span><span class="pl-c"><span class="pl-c">#</span>fields字段随后会被存储在es中通过kibana进行查询，便于识别这些日志数据来源于Apache服务；</span>
    
    
<span class="pl-c"><span class="pl-c">#</span>输出到kafka 此输出可以连接到 Kafka 0.8.2.0 及更高版本</span>
<span class="pl-ent">output.kafka</span>:
  <span class="pl-c"><span class="pl-c">#</span>用于读取集群元数据的brokers</span>
  <span class="pl-ent">hosts</span>: <span class="pl-s">["kafka1:9092", "kafka2:9092", "kafka3:9092"]</span>
  <span class="pl-c"><span class="pl-c">#</span>消息主题选择+分区</span>
  <span class="pl-ent">topic</span>: <span class="pl-s"><span class="pl-pds">'</span>%{[fields.log_topic]}<span class="pl-pds">'</span></span>
  <span class="pl-ent">partition.round_robin</span>:
    <span class="pl-ent">reachable_only</span>: <span class="pl-c1">false</span>

  <span class="pl-ent">required_acks</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">compression</span>: <span class="pl-s">gzip</span>
  <span class="pl-ent">max_message_bytes</span>: <span class="pl-c1">1000000</span> <span class="pl-c"><span class="pl-c">#</span>大于 max_message_bytes 的事件将被丢弃</span></pre></div>
<h3>kafka+kafka-ui</h3>
<blockquote>
<p>kafka为docker部署，镜像版本为：apache/kafka:3.7.0</p>
</blockquote>
<p><strong>docker-compose.yml</strong></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">networks</span>:
  <span class="pl-ent">kafka</span>:
    <span class="pl-ent">name</span>: <span class="pl-s">kafka</span>
    <span class="pl-ent">driver</span>: <span class="pl-s">bridge</span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">kafka</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">apache/kafka:3.7.0</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">user</span>: <span class="pl-s">root</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./config:/mnt/shared/config	</span><span class="pl-c"><span class="pl-c">#</span> 需要看kafka文档，需要挂载此路径下的配置文件才可以进行更新</span>
      - <span class="pl-s">./data:/var/lib/kafka/data</span>
      - <span class="pl-s">./logs:/opt/kafka/logs</span>
      - <span class="pl-s">./kraft-combined-logs:/var/log/kafka/kraft-combined-logs</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>9092:9092<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>9093:9093<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>9094:9094<span class="pl-pds">"</span></span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">kafka</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">kafka</span>

  <span class="pl-ent">kafka-ui</span>:
    <span class="pl-ent">container_name</span>: <span class="pl-s">kafka-ui</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">image</span>: <span class="pl-s">provectuslabs/kafka-ui:latest</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>8001:8080<span class="pl-pds">"</span></span>
    <span class="pl-ent">environment</span>:
      <span class="pl-ent">DYNAMIC_CONFIG_ENABLED</span>: <span class="pl-c1">true</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./kafka-ui/dynamic_config.yaml:/etc/kafkaui/dynamic_config.yaml</span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">1G</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">kafka</span></pre></div>
<blockquote>
<p>只列出示例配置文件中的原始部分和修改部分</p>
</blockquote>
<p><code class="notranslate">server.properties</code></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span>listeners=PLAINTEXT://:9092,CONTROLLER://:9093</span>
listeners=INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:9094,CONTROLLER://:9093

<span class="pl-c"><span class="pl-c">#</span> Name of listener used for communication between brokers.</span>
<span class="pl-c"><span class="pl-c">#</span>inter.broker.listener.name=PLAINTEXT,INSIDE,OUTSIDE</span>
inter.broker.listener.name=INSIDE

<span class="pl-c"><span class="pl-c">#</span> Listener name, hostname and port the broker will advertise to clients.</span>
<span class="pl-c"><span class="pl-c">#</span> If not set, it uses the value for "listeners".</span>
advertised.listeners=INSIDE://moniti.xxxxxx.cn:9092,OUTSIDE://monito.xxxxxx.cn:9094

<span class="pl-c"><span class="pl-c">#</span> A comma-separated list of the names of the listeners used by the controller.</span>
<span class="pl-c"><span class="pl-c">#</span> If no explicit mapping set in `listener.security.protocol.map`, default will be using PLAINTEXT protocol</span>
<span class="pl-c"><span class="pl-c">#</span> This is required if running in KRaft mode.</span>
controller.listener.names=CONTROLLER

<span class="pl-c"><span class="pl-c">#</span> Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span>
<span class="pl-c"><span class="pl-c">#</span>listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span>
listener.security.protocol.map=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT,CONTROLLER:PLAINTEXT

<span class="pl-c"><span class="pl-c">#</span> A comma separated list of directories under which to store log files</span>
log.dirs=/var/log/kafka/kraft-combined-logs

<span class="pl-c"><span class="pl-c">#</span> The minimum age of a log file to be eligible for deletion due to age</span>
log.retention.hours=168</pre></div>
<p><code class="notranslate">dynamic_config.yaml</code><em>——此文件为kafka-ui自动生成</em></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">auth</span>:
  <span class="pl-ent">type</span>: <span class="pl-s">DISABLED </span><span class="pl-c"><span class="pl-c">#</span>此位置可以接入ldap</span>
<span class="pl-ent">kafka</span>:
  <span class="pl-ent">clusters</span>:
  - <span class="pl-ent">bootstrapServers</span>: <span class="pl-s">kafka:9092</span>
    <span class="pl-ent">name</span>: <span class="pl-s">kafka-log</span>
    <span class="pl-ent">properties</span>: <span class="pl-s">{}</span>
    <span class="pl-ent">readOnly</span>: <span class="pl-c1">false</span>
<span class="pl-ent">rbac</span>:
  <span class="pl-ent">roles</span>: <span class="pl-s">[]</span>
<span class="pl-ent">webclient</span>: <span class="pl-s">{}</span></pre></div>
<h3>filebeat 2</h3>
<blockquote>
<p>此filebeat为消费者，消费kafka中的日志信息并由processer处理后存入es对应的index中</p>
</blockquote>
<p><code class="notranslate">filebeat.docker.yml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">filebeat.inputs</span>:
- <span class="pl-ent">type</span>: <span class="pl-s">kafka</span>
  <span class="pl-ent">hosts</span>:  <span class="pl-c"><span class="pl-c">#</span> Kafka 引导主机（代理）列表</span>
    - <span class="pl-s">kafka-broker-1:9092</span>
    - <span class="pl-s">kafka-broker-2:9092</span>
  <span class="pl-ent">topics</span>: <span class="pl-s">["my-topic"]</span>
  <span class="pl-ent">group_id</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat<span class="pl-pds">"</span></span>  <span class="pl-c"><span class="pl-c">#</span>消费者组 ID</span>
  <span class="pl-ent">fetch.min</span>: <span class="pl-c1">500000</span>   <span class="pl-c"><span class="pl-c">#</span>要等待的最小字节数,默认为 1。</span>

<span class="pl-ent">processors</span>:
  - <span class="pl-ent">decode_json_fields</span>:
      <span class="pl-ent">fields</span>: <span class="pl-s">["message"]</span>
      <span class="pl-ent">max_depth</span>: <span class="pl-c1">2</span>
      <span class="pl-ent">target</span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
      <span class="pl-ent">overwrite_keys</span>: <span class="pl-c1">true</span>
      <span class="pl-ent">add_error_key</span>: <span class="pl-c1">true</span>
  
<span class="pl-c"><span class="pl-c">#</span> 输出到es</span>
<span class="pl-ent">output.elasticsearch</span>:
  <span class="pl-ent">hosts</span>: <span class="pl-s">["https://myEShost:9200"]</span>
  <span class="pl-ent">username</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat_writer<span class="pl-pds">"</span></span>
  <span class="pl-ent">password</span>: <span class="pl-s"><span class="pl-pds">"</span>YOUR_PASSWORD<span class="pl-pds">"</span></span>
  <span class="pl-ent">indices</span>:
  - <span class="pl-ent">index</span>: <span class="pl-s"><span class="pl-pds">"</span>%{[fields.log_topic]}-%{[agent.version]}-%{+yyyy.MM.dd}<span class="pl-pds">"</span></span>
    <span class="pl-ent">when.contains</span>:
      <span class="pl-ent">fields.log_topic</span>: <span class="pl-s"><span class="pl-pds">"</span>log_name_example<span class="pl-pds">"</span></span>
  - <span class="pl-ent">index</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}-%{+yyyy.MM.dd}<span class="pl-pds">"</span></span>
  
<span class="pl-c"><span class="pl-c">#</span> 确保Filebeat可以使用索引模板</span>
<span class="pl-ent">setup.ilm.enabled</span>: <span class="pl-c1">false</span>
<span class="pl-ent">setup.template.enabled</span>: <span class="pl-c1">false</span>
<span class="pl-ent">setup.template.overwrite</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.template.json.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.template.name</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.pattern</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}-*<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.settings</span>:
  <span class="pl-ent">index.number_of_shards</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">index.number_of_replicas</span>: <span class="pl-c1">0</span></pre></div>
<h3>Elasticsearch</h3>
<p><code class="notranslate">elasticsearch.yml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">cluster.name</span>: <span class="pl-s"><span class="pl-pds">"</span>docker-cluster<span class="pl-pds">"</span></span>
<span class="pl-ent">network.host</span>: <span class="pl-s">0.0.0.0</span>
<span class="pl-ent">discovery.seed_hosts</span>: <span class="pl-s">["192.168.8.99"]</span>
<span class="pl-c"><span class="pl-c">#</span>cluster.initial_master_nodes: ["docker-cluster"]</span>
<span class="pl-ent">discovery.type</span>: <span class="pl-s">single-node</span>
<span class="pl-c"><span class="pl-c">#</span> 开启x-pack插件,用于添加账号密码、安全控制等配置</span>
<span class="pl-ent">xpack.security.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-c"><span class="pl-c">#</span>xpack.security.http.ssl.enabled: false</span>
<span class="pl-ent">xpack.security.transport.ssl.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">xpack.security.transport.ssl.verification_mode</span>: <span class="pl-s">certificate</span>
<span class="pl-ent">xpack.security.transport.ssl.keystore.path</span>: <span class="pl-s">/usr/share/elasticsearch/data/certs/elastic-certificates.p12</span>
<span class="pl-ent">xpack.security.transport.ssl.truststore.path</span>: <span class="pl-s">/usr/share/elasticsearch/data/certs/elastic-certificates.p12</span>
<span class="pl-c"><span class="pl-c">#</span>xpack.security.enrollment.enabled: true</span></pre></div>
<h3>Kibana</h3>
<p><code class="notranslate">kibana.yml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> Default Kibana configuration for docker target</span>
<span class="pl-ent">server.host</span>: <span class="pl-s"><span class="pl-pds">"</span>0.0.0.0<span class="pl-pds">"</span></span>
<span class="pl-ent">server.shutdownTimeout</span>: <span class="pl-s"><span class="pl-pds">"</span>5s<span class="pl-pds">"</span></span>
<span class="pl-ent">elasticsearch.hosts</span>: <span class="pl-s">[ "http://elasticsearch:9200" ]</span>
<span class="pl-ent">monitoring.ui.container.elasticsearch.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">elasticsearch.ssl.certificateAuthorities</span>: <span class="pl-s"><span class="pl-pds">"</span>/usr/share/kibana/config/certs/elastic-stack-ca.p12<span class="pl-pds">"</span></span>
<span class="pl-ent">elasticsearch.username</span>: <span class="pl-s"><span class="pl-pds">"</span>kibana<span class="pl-pds">"</span></span>
<span class="pl-ent">elasticsearch.password</span>: <span class="pl-s"><span class="pl-pds">"</span>elastic<span class="pl-pds">"</span></span>
<span class="pl-ent">i18n.locale</span>: <span class="pl-s"><span class="pl-pds">"</span>zh-CN<span class="pl-pds">"</span></span></pre></div>
<h3>Elastalert</h3>
<p><code class="notranslate">config.yaml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> This is the folder that contains the rule yaml files</span>
<span class="pl-c"><span class="pl-c">#</span> This can also be a list of directories</span>
<span class="pl-c"><span class="pl-c">#</span> Any .yaml file will be loaded as a rule</span>
<span class="pl-ent">rules_folder</span>: <span class="pl-s">/opt/elastalert/rules</span>

<span class="pl-c"><span class="pl-c">#</span> How often ElastAlert will query Elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span> The unit can be anything from weeks to seconds</span>
<span class="pl-ent">run_every</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">1</span>

<span class="pl-c"><span class="pl-c">#</span> ElastAlert will buffer results from the most recent</span>
<span class="pl-c"><span class="pl-c">#</span> period of time, in case some log sources are not in real time</span>
<span class="pl-ent">buffer_time</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">15</span>

<span class="pl-c"><span class="pl-c">#</span> The Elasticsearch hostname for metadata writeback</span>
<span class="pl-c"><span class="pl-c">#</span> Note that every rule can have its own Elasticsearch host</span>
<span class="pl-ent">es_host</span>: <span class="pl-s">10.1.1.30</span>

<span class="pl-c"><span class="pl-c">#</span> The Elasticsearch port</span>
<span class="pl-ent">es_port</span>: <span class="pl-c1">9200</span>

<span class="pl-c"><span class="pl-c">#</span> The AWS region to use. Set this when using AWS-managed elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span>aws_region: us-east-1</span>

<span class="pl-c"><span class="pl-c">#</span> The AWS profile to use. Use this if you are using an aws-cli profile.</span>
<span class="pl-c"><span class="pl-c">#</span> See http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html</span>
<span class="pl-c"><span class="pl-c">#</span> for details</span>
<span class="pl-c"><span class="pl-c">#</span>profile: test</span>

<span class="pl-c"><span class="pl-c">#</span> Optional URL prefix for Elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span>es_url_prefix: elasticsearch</span>

<span class="pl-c"><span class="pl-c">#</span> Optional prefix for statsd metrics</span>
<span class="pl-c"><span class="pl-c">#</span>statsd_instance_tag: elastalert</span>

<span class="pl-c"><span class="pl-c">#</span> Optional statsd host</span>
<span class="pl-c"><span class="pl-c">#</span>statsd_host: dogstatsd</span>

<span class="pl-c"><span class="pl-c">#</span> Connect with TLS to Elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span>use_ssl: True</span>

<span class="pl-c"><span class="pl-c">#</span> Verify TLS certificates</span>
<span class="pl-c"><span class="pl-c">#</span>verify_certs: True</span>

<span class="pl-c"><span class="pl-c">#</span> Show TLS or certificate related warnings</span>
<span class="pl-c"><span class="pl-c">#</span>ssl_show_warn: True</span>

<span class="pl-c"><span class="pl-c">#</span> GET request with body is the default option for Elasticsearch.</span>
<span class="pl-c"><span class="pl-c">#</span> If it fails for some reason, you can pass 'GET', 'POST' or 'source'.</span>
<span class="pl-c"><span class="pl-c">#</span> See https://elasticsearch-py.readthedocs.io/en/master/connection.html?highlight=send_get_body_as#transport</span>
<span class="pl-c"><span class="pl-c">#</span> for details</span>
<span class="pl-c"><span class="pl-c">#</span>es_send_get_body_as: GET</span>

<span class="pl-c"><span class="pl-c">#</span> Option basic-auth username and password for Elasticsearch</span>
<span class="pl-ent">es_username</span>: <span class="pl-s">elastic</span>
<span class="pl-ent">es_password</span>: <span class="pl-s">elastic</span>

<span class="pl-c"><span class="pl-c">#</span> Use SSL authentication with client certificates client_cert must be</span>
<span class="pl-c"><span class="pl-c">#</span> a pem file containing both cert and key for client</span>
<span class="pl-c"><span class="pl-c">#</span>ca_certs: /path/to/cacert.pem</span>
<span class="pl-c"><span class="pl-c">#</span>client_cert: /path/to/client_cert.pem</span>
<span class="pl-c"><span class="pl-c">#</span>client_key: /path/to/client_key.key</span>

<span class="pl-c"><span class="pl-c">#</span> The index on es_host which is used for metadata storage</span>
<span class="pl-c"><span class="pl-c">#</span> This can be a unmapped index, but it is recommended that you run</span>
<span class="pl-c"><span class="pl-c">#</span> elastalert-create-index to set a mapping</span>
<span class="pl-ent">writeback_index</span>: <span class="pl-s">elastalert_status</span>

<span class="pl-c"><span class="pl-c">#</span> If an alert fails for some reason, ElastAlert will retry</span>
<span class="pl-c"><span class="pl-c">#</span> sending the alert until this time period has elapsed</span>
<span class="pl-ent">alert_time_limit</span>:
  <span class="pl-ent">days</span>: <span class="pl-c1">2</span>

<span class="pl-c"><span class="pl-c">#</span> 可选的时间戳格式。</span>
<span class="pl-c"><span class="pl-c">#</span> ElastAlert将使用此格式在警报消息和日志消息中打印时间戳。</span>
<span class="pl-ent">custom_pretty_ts_format</span>: <span class="pl-s"><span class="pl-pds">'</span>%Y-%m-%d %H:%M<span class="pl-pds">'</span></span>

<span class="pl-c"><span class="pl-c">#</span> 自定义日志配置</span>
<span class="pl-c"><span class="pl-c">#</span> 如果您希望设置自己的日志配置以记录到文件中，或记录到Logstash，并且/或者修改日志级别，请使用下面的配置并根据需要进行调整。</span>
<span class="pl-c"><span class="pl-c">#</span> 注意：如果您以--verbose/--debug运行ElastAlert，“elastalert”记录器的日志级别将更改为INFO，如果它还不是INFO/DEBUG。</span>
<span class="pl-ent">logging</span>:
 <span class="pl-ent">version</span>: <span class="pl-c1">1</span>
 <span class="pl-ent">incremental</span>: <span class="pl-c1">false</span>
 <span class="pl-ent">disable_existing_loggers</span>: <span class="pl-c1">false</span>
 <span class="pl-ent">formatters</span>:
   <span class="pl-ent">logline</span>:
     <span class="pl-ent">format</span>: <span class="pl-s"><span class="pl-pds">'</span>%(asctime)s %(levelname)+8s %(name)+20s %(message)s<span class="pl-pds">'</span></span>

 <span class="pl-ent">handlers</span>:
   <span class="pl-ent">console</span>:
     <span class="pl-ent">class</span>: <span class="pl-s">logging.StreamHandler</span>
     <span class="pl-ent">formatter</span>: <span class="pl-s">logline</span>
     <span class="pl-ent">level</span>: <span class="pl-s">DEBUG</span>
     <span class="pl-ent">stream</span>: <span class="pl-s">ext://sys.stderr</span>

   <span class="pl-ent">file</span>:
     <span class="pl-ent">class </span>: <span class="pl-s">logging.FileHandler</span>
     <span class="pl-ent">formatter</span>: <span class="pl-s">logline</span>
     <span class="pl-ent">level</span>: <span class="pl-s">DEBUG</span>
     <span class="pl-ent">filename</span>: <span class="pl-s">elastalert.log</span>

 <span class="pl-ent">loggers</span>:
   <span class="pl-ent">elastalert</span>:
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>: <span class="pl-s">[]</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">true</span>

   <span class="pl-ent">elasticsearch</span>:
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>: <span class="pl-s">[]</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">true</span>

   <span class="pl-ent">elasticsearch.trace</span>:
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>: <span class="pl-s">[]</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">true</span>

   <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>:  <span class="pl-c"><span class="pl-c">#</span> 根记录器</span>
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>:
       - <span class="pl-s">console</span>
       - <span class="pl-s">file</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">false</span></pre></div>
<p><code class="notranslate">nginx-rules.yaml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">"</span>Nginx-Error<span class="pl-pds">"</span></span>
<span class="pl-ent">type</span>: <span class="pl-s"><span class="pl-pds">"</span>frequency<span class="pl-pds">"</span></span>
<span class="pl-ent">index</span>: <span class="pl-s"><span class="pl-pds">"</span>nginx-error-8.13.2*<span class="pl-pds">"</span></span>  <span class="pl-c"><span class="pl-c">#</span> 查询日志所在的索引</span>
<span class="pl-ent">is_enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">num_events</span>: <span class="pl-c1">3</span>  <span class="pl-c"><span class="pl-c">#</span> 事件出现的次数</span>
<span class="pl-ent">timeframe</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">2</span>   <span class="pl-c"><span class="pl-c">#</span> 1分钟内出现了num_events几次就报警</span>
<span class="pl-ent">realert</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">180</span>   <span class="pl-c"><span class="pl-c">#</span> 5分钟内忽略重复告警</span>
<span class="pl-ent">timestamp_field</span>: <span class="pl-s"><span class="pl-pds">"</span>@timestamp<span class="pl-pds">"</span></span>
<span class="pl-ent">timestamp_type</span>: <span class="pl-s"><span class="pl-pds">"</span>iso<span class="pl-pds">"</span></span>
<span class="pl-ent">use_strftime_index</span>: <span class="pl-c1">true</span>
<span class="pl-ent">filter</span>:
  - <span class="pl-ent">query</span>:
      <span class="pl-ent">query_string</span>:
        <span class="pl-ent">query</span>: <span class="pl-s"><span class="pl-pds">"</span>message:<span class="pl-cce">\"</span>error<span class="pl-cce">\"</span> NOT message:<span class="pl-cce">\"</span>No such file or directory<span class="pl-cce">\"</span> NOT message:<span class="pl-cce">\"</span>forbidden by rule<span class="pl-cce">\"</span><span class="pl-pds">"</span></span>  <span class="pl-c"><span class="pl-c">#</span> 告警查询语句</span>

<span class="pl-ent">alert_text_type</span>: <span class="pl-s">alert_text_only</span>
<span class="pl-ent">alert_text</span>: <span class="pl-s"><span class="pl-pds">"</span>### Nginx-Error(Prod)日志告警<span class="pl-cce">\n</span>- **采集位置:** {0}<span class="pl-cce">\n</span>- **文件:** {1}<span class="pl-cce">\n</span>- **匹配次数:** {2}<span class="pl-cce">\n</span>- **日志id:** {3}<span class="pl-cce">\n\n</span>- [点我去查询]()<span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">#</span> 上述括号中填写查询链接</span>
<span class="pl-ent">alert_text_args</span>:   <span class="pl-c"><span class="pl-c">#</span> 告警模板中用到的参数</span>
  - <span class="pl-s">agent.name</span>
  - <span class="pl-s"><span class="pl-pds">"</span>log.file.path<span class="pl-pds">"</span></span>
  - <span class="pl-s">num_matches</span>
  - <span class="pl-s">_id</span>
  - <span class="pl-s">_id</span>

<span class="pl-ent">alert</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>dingtalk<span class="pl-pds">"</span></span>
<span class="pl-ent">dingtalk_access_token</span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
<span class="pl-ent">dingtalk_msgtype</span>: <span class="pl-s"><span class="pl-pds">"</span>markdown<span class="pl-pds">"</span></span></pre></div>
<h3>docker compose 部署</h3>
<h4>生产端</h4>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">services</span>:
  <span class="pl-ent">filebeat</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/filebeat:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">filebeat</span>
    <span class="pl-ent">user</span>: <span class="pl-s">root</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span>
      - <span class="pl-s">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
      - <span class="pl-s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      - <span class="pl-s">./data:/usr/share/filebeat/data:rw</span>
      - <span class="pl-s">/home:/home</span>
      - <span class="pl-s">/var/log:/var/log</span></pre></div>
<h4>消费端</h4>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">networks</span>:
  <span class="pl-ent">logstack</span>:
    <span class="pl-ent">name</span>: <span class="pl-s">logstack</span>
    <span class="pl-ent">driver</span>: <span class="pl-s">bridge</span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">filebeat</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/filebeat:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">filebeat</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>5067:5067<span class="pl-pds">"</span></span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./filebeat/filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span>
      - <span class="pl-s">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
      - <span class="pl-s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      - <span class="pl-s">./filebeat/data:/usr/share/filebeat/data:rw</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">elasticsearch</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/elasticsearch:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">elasticsearch</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">environment</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>ES_JAVA_OPTS=-Xms6144m -Xmx6144m<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>cluster.name=elasticsearch<span class="pl-pds">"</span></span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./elasticsearch/data:/usr/share/elasticsearch/data</span>
      - <span class="pl-s">./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>9200:9200<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>9300:9300<span class="pl-pds">"</span></span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">kibana</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/kibana:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">kibana</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml</span>
      - <span class="pl-s">./kibana/certs:/usr/share/kibana/config/certs</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>5601:5601<span class="pl-pds">"</span></span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">elasticsearch</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">metricbeat</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/metricbeat:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">metricbeat</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./metricbeat/metricbeat.docker.yml:/usr/share/metricbeat/metricbeat.yml:ro</span>
      - <span class="pl-s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      - <span class="pl-s">/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro</span>
      - <span class="pl-s">/proc:/hostfs/proc:ro</span>
      - <span class="pl-s">/:/hostfs:ro</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">esalert</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">jertel/elastalert2:2.18.0</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">esalert</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">user</span>: <span class="pl-s">root</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./esalert/config.yaml:/opt/elastalert/config.yaml</span>
      - <span class="pl-s">./esalert/rules:/opt/elastalert/rules</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">elasticsearch</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>
    <span class="pl-ent">environment</span>:
      <span class="pl-ent">TZ</span>: <span class="pl-s"><span class="pl-pds">"</span>Asia/Shanghai<span class="pl-pds">"</span></span></pre></div>
<h2>非结构化日志(未测试)</h2>
<h3>filebeat 1</h3>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">filebeat.inputs</span>:
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span><span class="pl-c"><span class="pl-c">#</span>新版本常用文件流输入方式</span>
  <span class="pl-ent">id</span>: <span class="pl-s">my-filestream-id </span><span class="pl-c"><span class="pl-c">#</span>每个文件流输入必须有一个唯一的 ID。省略或更改文件流 ID 可能会导致数据重复。如果没有唯一的 ID，filestream 无法正确跟踪文件的状态。</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s">/var/log/messages</span>
    - <span class="pl-s">/var/log/*.log</span>
    
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span>
  <span class="pl-ent">id</span>: <span class="pl-s">apache-filestream-id</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s"><span class="pl-pds">"</span>/var/log/apache2/*<span class="pl-pds">"</span></span>
  <span class="pl-ent">fields</span>:
    <span class="pl-ent">apache</span>: <span class="pl-s">true </span><span class="pl-c"><span class="pl-c">#</span>fields字段随后会被存储在es中通过kibana进行查询，便于识别这些日志数据来源于Apache服务；</span>
    
    
<span class="pl-c"><span class="pl-c">#</span>输出到kafka 此输出可以连接到 Kafka 0.8.2.0 及更高版本</span>
<span class="pl-ent">output.kafka</span>:
  <span class="pl-c"><span class="pl-c">#</span>用于读取集群元数据的brokers</span>
  <span class="pl-ent">hosts</span>: <span class="pl-s">["kafka1:9092", "kafka2:9092", "kafka3:9092"]</span>
  <span class="pl-c"><span class="pl-c">#</span>消息主题选择+分区</span>
  <span class="pl-ent">topic</span>: <span class="pl-s"><span class="pl-pds">'</span>%{[fields.log_topic]}<span class="pl-pds">'</span></span>
  <span class="pl-ent">partition.round_robin</span>:
    <span class="pl-ent">reachable_only</span>: <span class="pl-c1">false</span>

  <span class="pl-ent">required_acks</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">compression</span>: <span class="pl-s">gzip</span>
  <span class="pl-ent">max_message_bytes</span>: <span class="pl-c1">1000000</span> <span class="pl-c"><span class="pl-c">#</span>大于 max_message_bytes 的事件将被丢弃</span></pre></div>
<h3>kafka</h3>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span>暂定</span></pre></div>
<h3>logstash</h3>
<pre lang="conf" class="notranslate"><code class="notranslate">input {
  kafka {
    id =&gt; "my-kafka-consumer" # 唯一标识此Kafka消费者
    topics =&gt; ["my-topic"] # Kafka主题列表
    topic_id =&gt; "%{topic}" # 用于标识消息来自哪个主题
    group_id =&gt; "my-consumer-group" # Kafka消费者组ID
    bootstrap_servers =&gt; "localhost:9092" # Kafka服务器地址
    # 其他可选配置
    auto_offset_reset =&gt; "earliest" # 当没有初始偏移量时，从最早的消息开始消费
    enable_auto_commit =&gt; true # 自动提交偏移量
    max_poll_records =&gt; 500 # 每次轮询获取的最大记录数
    max_poll_interval_ms =&gt; 300000 # 轮询间隔的最大毫秒数
  }
}

filter {
  # 在这里添加任何你需要的过滤或数据转换操作
  # 例如，使用grok插件解析日志格式
  grok {
    match =&gt; { "message" =&gt; "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{WORD:thread} %{GREEDYDATA:message}" }
  }
  date {
    match =&gt; ["timestamp", "ISO8601"] # 转换时间戳格式
  }
  mutate {
    lowercase =&gt; ["level"] # 将日志级别转换为小写
  }
}

output {
  elasticsearch {
    hosts =&gt; ["https://...] 
    cacert =&gt; '/etc/logstash/config/certs/ca.crt' 
  }
}
</code></pre>
<h1>问题</h1>
<ol>
<li>
<p>this action would add [2] shards, but this cluster currently has [1000]/[1000] maximum normal shards open：es分片数量超限</p>
<pre class="notranslate"><code class="notranslate">PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "max_shards_per_node":10000
    }
  }
}

#查询
GET /_cluster/settings?pretty
</code></pre>
</li>
</ol></div>
<div style="font-size:small;margin-top:8px;float:right;">转载请注明出处</div>
<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>
</div>
    <div id="footer">Copyright © <span id="year"></span><a href="https://blog.witter.top"> V's Blog </a>
<p><a href="https://beian.miit.gov.cn/" target="_blank">冀ICP备2022019998号</a>
<span id="runday"></span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a>
</p>

<script>
if("06/20/2024"!=""){
    var now=new Date();
    var startSite=new Date("06/20/2024");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("year").innerHTML=now.getFullYear();
    if("冀ICP备2022019998号"!=""){document.getElementById("runday").innerHTML=" • "+"网站运行"+diffDay+"天"+" • ";}
    else{document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";}
}
</script>
</div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n\n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);

function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","ljwtorch/ljwtorch.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}
</script>


</html>
