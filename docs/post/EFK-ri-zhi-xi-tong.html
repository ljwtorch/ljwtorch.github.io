<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://img.witter.top/file/b037878209903b7d5bb17.jpg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="**æ³¨ï¼šç°åœ¨æ–°ç‰ˆæœ¬elastic stackå·²ç»æ”¯æŒå°†kafkaä½œä¸ºè¾“å‡ºå’Œè¾“å…¥çš„ç›®æ ‡**

å½“æ—¥å¿—ä¸æ˜¯ç»“æ„åŒ–æ•°æ®ï¼š*.log->filebeat->kafka->logstash->elasticsearch

å½“æ—¥å¿—æ˜¯ç»“æ„åŒ–æ•°æ®ï¼š*.log->filebeat->kafka->filebeat->elasticsearch

åŒºåˆ«åœ¨äºæ˜¯å¦éœ€è¦logstashè¿›è¡Œæ—¥å¿—çš„è¿‡æ»¤å’Œç»“æ„åŒ–ï¼›

## ç»“æ„åŒ–æ—¥å¿—

**è¿æ¥ç¤ºä¾‹é…ç½®æ–‡ä»¶**

### filebeat 1

> æ­¤filebeatå®ä¾‹ä¸ºæ—¥å¿—é‡‡é›†ç«¯ï¼Œå³kafkaç”Ÿäº§è€…ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®ä¾‹è¿›è¡Œé‡‡é›†

```yaml
filebeat.inputs:
- type: filestream #æ–°ç‰ˆæœ¬å¸¸ç”¨æ–‡ä»¶æµè¾“å…¥æ–¹å¼
  id: my-filestream-id #æ¯ä¸ªæ–‡ä»¶æµè¾“å…¥å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚">
<meta property="og:title" content="EFKæ—¥å¿—ç³»ç»Ÿ">
<meta property="og:description" content="**æ³¨ï¼šç°åœ¨æ–°ç‰ˆæœ¬elastic stackå·²ç»æ”¯æŒå°†kafkaä½œä¸ºè¾“å‡ºå’Œè¾“å…¥çš„ç›®æ ‡**

å½“æ—¥å¿—ä¸æ˜¯ç»“æ„åŒ–æ•°æ®ï¼š*.log->filebeat->kafka->logstash->elasticsearch

å½“æ—¥å¿—æ˜¯ç»“æ„åŒ–æ•°æ®ï¼š*.log->filebeat->kafka->filebeat->elasticsearch

åŒºåˆ«åœ¨äºæ˜¯å¦éœ€è¦logstashè¿›è¡Œæ—¥å¿—çš„è¿‡æ»¤å’Œç»“æ„åŒ–ï¼›

## ç»“æ„åŒ–æ—¥å¿—

**è¿æ¥ç¤ºä¾‹é…ç½®æ–‡ä»¶**

### filebeat 1

> æ­¤filebeatå®ä¾‹ä¸ºæ—¥å¿—é‡‡é›†ç«¯ï¼Œå³kafkaç”Ÿäº§è€…ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®ä¾‹è¿›è¡Œé‡‡é›†

```yaml
filebeat.inputs:
- type: filestream #æ–°ç‰ˆæœ¬å¸¸ç”¨æ–‡ä»¶æµè¾“å…¥æ–¹å¼
  id: my-filestream-id #æ¯ä¸ªæ–‡ä»¶æµè¾“å…¥å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.witter.top/post/EFK-ri-zhi-xi-tong.html">
<meta property="og:image" content="https://img.witter.top/file/b037878209903b7d5bb17.jpg">
<title>EFKæ—¥å¿—ç³»ç»Ÿ</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>
<style>.markdown-alert{padding:0.5rem 1rem;margin-bottom:1rem;border-left:.25em solid var(--borderColor-default,var(--color-border-default));}.markdown-alert .markdown-alert-title {display:flex;font-weight:var(--base-text-weight-medium,500);align-items:center;line-height:1;}.markdown-alert>:first-child {margin-top:0;}.markdown-alert>:last-child {margin-bottom:0;}</style><style>.markdown-alert.markdown-alert-tip {border-left-color:var(--borderColor-success-emphasis, var(--color-success-emphasis));background-color:var(--color-success-subtle);}.markdown-alert.markdown-alert-tip .markdown-alert-title {color: var(--fgColor-success,var(--color-success-fg));}</style>



<body>
    <div id="header">
<h1 class="postTitle">EFKæ—¥å¿—ç³»ç»Ÿ</h1>
<div class="title-right">
    <a href="https://blog.witter.top" id="buttonHome" class="btn btn-invisible circle" title="é¦–é¡µ">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/ljwtorch/ljwtorch.github.io/issues/4" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="åˆ‡æ¢ä¸»é¢˜">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><p><strong>æ³¨ï¼šç°åœ¨æ–°ç‰ˆæœ¬elastic stackå·²ç»æ”¯æŒå°†kafkaä½œä¸ºè¾“å‡ºå’Œè¾“å…¥çš„ç›®æ ‡</strong></p>
<p>å½“æ—¥å¿—ä¸æ˜¯ç»“æ„åŒ–æ•°æ®ï¼š*.log-&gt;filebeat-&gt;kafka-&gt;logstash-&gt;elasticsearch</p>
<p>å½“æ—¥å¿—æ˜¯ç»“æ„åŒ–æ•°æ®ï¼š*.log-&gt;filebeat-&gt;kafka-&gt;filebeat-&gt;elasticsearch</p>
<p>åŒºåˆ«åœ¨äºæ˜¯å¦éœ€è¦logstashè¿›è¡Œæ—¥å¿—çš„è¿‡æ»¤å’Œç»“æ„åŒ–ï¼›</p>
<h2>ç»“æ„åŒ–æ—¥å¿—</h2>
<p><strong>è¿æ¥ç¤ºä¾‹é…ç½®æ–‡ä»¶</strong></p>
<h3>filebeat 1</h3>
<blockquote>
<p>æ­¤filebeatå®ä¾‹ä¸ºæ—¥å¿—é‡‡é›†ç«¯ï¼Œå³kafkaç”Ÿäº§è€…ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®ä¾‹è¿›è¡Œé‡‡é›†</p>
</blockquote>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">filebeat.inputs</span>:
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span><span class="pl-c"><span class="pl-c">#</span>æ–°ç‰ˆæœ¬å¸¸ç”¨æ–‡ä»¶æµè¾“å…¥æ–¹å¼</span>
  <span class="pl-ent">id</span>: <span class="pl-s">my-filestream-id </span><span class="pl-c"><span class="pl-c">#</span>æ¯ä¸ªæ–‡ä»¶æµè¾“å…¥å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚çœç•¥æˆ–æ›´æ”¹æ–‡ä»¶æµ ID å¯èƒ½ä¼šå¯¼è‡´æ•°æ®é‡å¤ã€‚å¦‚æœæ²¡æœ‰å”¯ä¸€çš„ IDï¼Œfilestream æ— æ³•æ­£ç¡®è·Ÿè¸ªæ–‡ä»¶çš„çŠ¶æ€ã€‚</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s">/var/log/messages</span>
    - <span class="pl-s">/var/log/*.log</span>
    
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span>
  <span class="pl-ent">id</span>: <span class="pl-s">apache-filestream-id</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s"><span class="pl-pds">"</span>/var/log/apache2/*<span class="pl-pds">"</span></span>
  <span class="pl-ent">fields</span>:
    <span class="pl-ent">apache</span>: <span class="pl-s">true </span><span class="pl-c"><span class="pl-c">#</span>fieldså­—æ®µéšåä¼šè¢«å­˜å‚¨åœ¨esä¸­é€šè¿‡kibanaè¿›è¡ŒæŸ¥è¯¢ï¼Œä¾¿äºè¯†åˆ«è¿™äº›æ—¥å¿—æ•°æ®æ¥æºäºApacheæœåŠ¡ï¼›</span>
    
    
<span class="pl-c"><span class="pl-c">#</span>è¾“å‡ºåˆ°kafka æ­¤è¾“å‡ºå¯ä»¥è¿æ¥åˆ° Kafka 0.8.2.0 åŠæ›´é«˜ç‰ˆæœ¬</span>
<span class="pl-ent">output.kafka</span>:
  <span class="pl-c"><span class="pl-c">#</span>ç”¨äºè¯»å–é›†ç¾¤å…ƒæ•°æ®çš„brokers</span>
  <span class="pl-ent">hosts</span>: <span class="pl-s">["kafka1:9092", "kafka2:9092", "kafka3:9092"]</span>
  <span class="pl-c"><span class="pl-c">#</span>æ¶ˆæ¯ä¸»é¢˜é€‰æ‹©+åˆ†åŒº</span>
  <span class="pl-ent">topic</span>: <span class="pl-s"><span class="pl-pds">'</span>%{[fields.log_topic]}<span class="pl-pds">'</span></span>
  <span class="pl-ent">partition.round_robin</span>:
    <span class="pl-ent">reachable_only</span>: <span class="pl-c1">false</span>

  <span class="pl-ent">required_acks</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">compression</span>: <span class="pl-s">gzip</span>
  <span class="pl-ent">max_message_bytes</span>: <span class="pl-c1">1000000</span> <span class="pl-c"><span class="pl-c">#</span>å¤§äº max_message_bytes çš„äº‹ä»¶å°†è¢«ä¸¢å¼ƒ</span></pre></div>
<h3>kafka+kafka-ui</h3>
<blockquote>
<p>kafkaä¸ºdockeréƒ¨ç½²ï¼Œé•œåƒç‰ˆæœ¬ä¸ºï¼šapache/kafka:3.7.0</p>
</blockquote>
<p><strong>docker-compose.yml</strong></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">networks</span>:
  <span class="pl-ent">kafka</span>:
    <span class="pl-ent">name</span>: <span class="pl-s">kafka</span>
    <span class="pl-ent">driver</span>: <span class="pl-s">bridge</span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">kafka</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">apache/kafka:3.7.0</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">user</span>: <span class="pl-s">root</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./config:/mnt/shared/config	</span><span class="pl-c"><span class="pl-c">#</span> éœ€è¦çœ‹kafkaæ–‡æ¡£ï¼Œéœ€è¦æŒ‚è½½æ­¤è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶æ‰å¯ä»¥è¿›è¡Œæ›´æ–°</span>
      - <span class="pl-s">./data:/var/lib/kafka/data</span>
      - <span class="pl-s">./logs:/opt/kafka/logs</span>
      - <span class="pl-s">./kraft-combined-logs:/var/log/kafka/kraft-combined-logs</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>9092:9092<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>9093:9093<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>9094:9094<span class="pl-pds">"</span></span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">kafka</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">kafka</span>

  <span class="pl-ent">kafka-ui</span>:
    <span class="pl-ent">container_name</span>: <span class="pl-s">kafka-ui</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">image</span>: <span class="pl-s">provectuslabs/kafka-ui:latest</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>8001:8080<span class="pl-pds">"</span></span>
    <span class="pl-ent">environment</span>:
      <span class="pl-ent">DYNAMIC_CONFIG_ENABLED</span>: <span class="pl-c1">true</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./kafka-ui/dynamic_config.yaml:/etc/kafkaui/dynamic_config.yaml</span>
    <span class="pl-ent">deploy</span>:
      <span class="pl-ent">resources</span>:
        <span class="pl-ent">limits</span>:
          <span class="pl-ent">memory</span>: <span class="pl-c1">1G</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">kafka</span></pre></div>
<blockquote>
<p>åªåˆ—å‡ºç¤ºä¾‹é…ç½®æ–‡ä»¶ä¸­çš„åŸå§‹éƒ¨åˆ†å’Œä¿®æ”¹éƒ¨åˆ†</p>
</blockquote>
<p><code class="notranslate">server.properties</code></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span>listeners=PLAINTEXT://:9092,CONTROLLER://:9093</span>
listeners=INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:9094,CONTROLLER://:9093

<span class="pl-c"><span class="pl-c">#</span> Name of listener used for communication between brokers.</span>
<span class="pl-c"><span class="pl-c">#</span>inter.broker.listener.name=PLAINTEXT,INSIDE,OUTSIDE</span>
inter.broker.listener.name=INSIDE

<span class="pl-c"><span class="pl-c">#</span> Listener name, hostname and port the broker will advertise to clients.</span>
<span class="pl-c"><span class="pl-c">#</span> If not set, it uses the value for "listeners".</span>
advertised.listeners=INSIDE://moniti.xxxxxx.cn:9092,OUTSIDE://monito.xxxxxx.cn:9094

<span class="pl-c"><span class="pl-c">#</span> A comma-separated list of the names of the listeners used by the controller.</span>
<span class="pl-c"><span class="pl-c">#</span> If no explicit mapping set in `listener.security.protocol.map`, default will be using PLAINTEXT protocol</span>
<span class="pl-c"><span class="pl-c">#</span> This is required if running in KRaft mode.</span>
controller.listener.names=CONTROLLER

<span class="pl-c"><span class="pl-c">#</span> Maps listener names to security protocols, the default is for them to be the same. See the config documentation for more details</span>
<span class="pl-c"><span class="pl-c">#</span>listener.security.protocol.map=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT,SSL:SSL,SASL_PLAINTEXT:SASL_PLAINTEXT,SASL_SSL:SASL_SSL</span>
listener.security.protocol.map=INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT,CONTROLLER:PLAINTEXT

<span class="pl-c"><span class="pl-c">#</span> A comma separated list of directories under which to store log files</span>
log.dirs=/var/log/kafka/kraft-combined-logs

<span class="pl-c"><span class="pl-c">#</span> The minimum age of a log file to be eligible for deletion due to age</span>
log.retention.hours=168</pre></div>
<p><code class="notranslate">dynamic_config.yaml</code><em>â€”â€”æ­¤æ–‡ä»¶ä¸ºkafka-uiè‡ªåŠ¨ç”Ÿæˆ</em></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">auth</span>:
  <span class="pl-ent">type</span>: <span class="pl-s">DISABLED </span><span class="pl-c"><span class="pl-c">#</span>æ­¤ä½ç½®å¯ä»¥æ¥å…¥ldap</span>
<span class="pl-ent">kafka</span>:
  <span class="pl-ent">clusters</span>:
  - <span class="pl-ent">bootstrapServers</span>: <span class="pl-s">kafka:9092</span>
    <span class="pl-ent">name</span>: <span class="pl-s">kafka-log</span>
    <span class="pl-ent">properties</span>: <span class="pl-s">{}</span>
    <span class="pl-ent">readOnly</span>: <span class="pl-c1">false</span>
<span class="pl-ent">rbac</span>:
  <span class="pl-ent">roles</span>: <span class="pl-s">[]</span>
<span class="pl-ent">webclient</span>: <span class="pl-s">{}</span></pre></div>
<h3>filebeat 2</h3>
<blockquote>
<p>æ­¤filebeatä¸ºæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹kafkaä¸­çš„æ—¥å¿—ä¿¡æ¯å¹¶ç”±processerå¤„ç†åå­˜å…¥eså¯¹åº”çš„indexä¸­</p>
</blockquote>
<p><code class="notranslate">filebeat.docker.yml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">filebeat.inputs</span>:
- <span class="pl-ent">type</span>: <span class="pl-s">kafka</span>
  <span class="pl-ent">hosts</span>:  <span class="pl-c"><span class="pl-c">#</span> Kafka å¼•å¯¼ä¸»æœºï¼ˆä»£ç†ï¼‰åˆ—è¡¨</span>
    - <span class="pl-s">kafka-broker-1:9092</span>
    - <span class="pl-s">kafka-broker-2:9092</span>
  <span class="pl-ent">topics</span>: <span class="pl-s">["my-topic"]</span>
  <span class="pl-ent">group_id</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat<span class="pl-pds">"</span></span>  <span class="pl-c"><span class="pl-c">#</span>æ¶ˆè´¹è€…ç»„ ID</span>
  <span class="pl-ent">fetch.min</span>: <span class="pl-c1">500000</span>   <span class="pl-c"><span class="pl-c">#</span>è¦ç­‰å¾…çš„æœ€å°å­—èŠ‚æ•°,é»˜è®¤ä¸º 1ã€‚</span>

<span class="pl-ent">processors</span>:
  - <span class="pl-ent">decode_json_fields</span>:
      <span class="pl-ent">fields</span>: <span class="pl-s">["message"]</span>
      <span class="pl-ent">max_depth</span>: <span class="pl-c1">2</span>
      <span class="pl-ent">target</span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
      <span class="pl-ent">overwrite_keys</span>: <span class="pl-c1">true</span>
      <span class="pl-ent">add_error_key</span>: <span class="pl-c1">true</span>
  
<span class="pl-c"><span class="pl-c">#</span> è¾“å‡ºåˆ°es</span>
<span class="pl-ent">output.elasticsearch</span>:
  <span class="pl-ent">hosts</span>: <span class="pl-s">["https://myEShost:9200"]</span>
  <span class="pl-ent">username</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat_writer<span class="pl-pds">"</span></span>
  <span class="pl-ent">password</span>: <span class="pl-s"><span class="pl-pds">"</span>YOUR_PASSWORD<span class="pl-pds">"</span></span>
  <span class="pl-ent">indices</span>:
  - <span class="pl-ent">index</span>: <span class="pl-s"><span class="pl-pds">"</span>%{[fields.log_topic]}-%{[agent.version]}-%{+yyyy.MM.dd}<span class="pl-pds">"</span></span>
    <span class="pl-ent">when.contains</span>:
      <span class="pl-ent">fields.log_topic</span>: <span class="pl-s"><span class="pl-pds">"</span>log_name_example<span class="pl-pds">"</span></span>
  - <span class="pl-ent">index</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}-%{+yyyy.MM.dd}<span class="pl-pds">"</span></span>
  
<span class="pl-c"><span class="pl-c">#</span> ç¡®ä¿Filebeatå¯ä»¥ä½¿ç”¨ç´¢å¼•æ¨¡æ¿</span>
<span class="pl-ent">setup.ilm.enabled</span>: <span class="pl-c1">false</span>
<span class="pl-ent">setup.template.enabled</span>: <span class="pl-c1">false</span>
<span class="pl-ent">setup.template.overwrite</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.template.json.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.template.name</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.pattern</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}-*<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.settings</span>:
  <span class="pl-ent">index.number_of_shards</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">index.number_of_replicas</span>: <span class="pl-c1">0</span></pre></div>
<h3>Elasticsearch</h3>
<p><code class="notranslate">elasticsearch.yml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">cluster.name</span>: <span class="pl-s"><span class="pl-pds">"</span>docker-cluster<span class="pl-pds">"</span></span>
<span class="pl-ent">network.host</span>: <span class="pl-s">0.0.0.0</span>
<span class="pl-ent">discovery.seed_hosts</span>: <span class="pl-s">["192.168.8.99"]</span>
<span class="pl-c"><span class="pl-c">#</span>cluster.initial_master_nodes: ["docker-cluster"]</span>
<span class="pl-ent">discovery.type</span>: <span class="pl-s">single-node</span>
<span class="pl-c"><span class="pl-c">#</span> å¼€å¯x-packæ’ä»¶,ç”¨äºæ·»åŠ è´¦å·å¯†ç ã€å®‰å…¨æ§åˆ¶ç­‰é…ç½®</span>
<span class="pl-ent">xpack.security.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-c"><span class="pl-c">#</span>xpack.security.http.ssl.enabled: false</span>
<span class="pl-ent">xpack.security.transport.ssl.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">xpack.security.transport.ssl.verification_mode</span>: <span class="pl-s">certificate</span>
<span class="pl-ent">xpack.security.transport.ssl.keystore.path</span>: <span class="pl-s">/usr/share/elasticsearch/data/certs/elastic-certificates.p12</span>
<span class="pl-ent">xpack.security.transport.ssl.truststore.path</span>: <span class="pl-s">/usr/share/elasticsearch/data/certs/elastic-certificates.p12</span>
<span class="pl-c"><span class="pl-c">#</span>xpack.security.enrollment.enabled: true</span></pre></div>
<h3>Kibana</h3>
<p><code class="notranslate">kibana.yml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> Default Kibana configuration for docker target</span>
<span class="pl-ent">server.host</span>: <span class="pl-s"><span class="pl-pds">"</span>0.0.0.0<span class="pl-pds">"</span></span>
<span class="pl-ent">server.shutdownTimeout</span>: <span class="pl-s"><span class="pl-pds">"</span>5s<span class="pl-pds">"</span></span>
<span class="pl-ent">elasticsearch.hosts</span>: <span class="pl-s">[ "http://elasticsearch:9200" ]</span>
<span class="pl-ent">monitoring.ui.container.elasticsearch.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">elasticsearch.ssl.certificateAuthorities</span>: <span class="pl-s"><span class="pl-pds">"</span>/usr/share/kibana/config/certs/elastic-stack-ca.p12<span class="pl-pds">"</span></span>
<span class="pl-ent">elasticsearch.username</span>: <span class="pl-s"><span class="pl-pds">"</span>kibana<span class="pl-pds">"</span></span>
<span class="pl-ent">elasticsearch.password</span>: <span class="pl-s"><span class="pl-pds">"</span>elastic<span class="pl-pds">"</span></span>
<span class="pl-ent">i18n.locale</span>: <span class="pl-s"><span class="pl-pds">"</span>zh-CN<span class="pl-pds">"</span></span></pre></div>
<h3>Elastalert</h3>
<p>[<a href="https://elastalert.readthedocs.io/en/latest/index.html" rel="nofollow">å®˜æ–¹æ–‡æ¡£</a>](<a href="https://elastalert.readthedocs.io/en/latest/index.html" rel="nofollow">https://elastalert.readthedocs.io/en/latest/index.html</a>)</p>
<h4>é…ç½®æ–‡ä»¶</h4>
<p><code class="notranslate">config.yaml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> This is the folder that contains the rule yaml files</span>
<span class="pl-c"><span class="pl-c">#</span> This can also be a list of directories</span>
<span class="pl-c"><span class="pl-c">#</span> Any .yaml file will be loaded as a rule</span>
<span class="pl-ent">rules_folder</span>: <span class="pl-s">/opt/elastalert/rules</span>

<span class="pl-c"><span class="pl-c">#</span> How often ElastAlert will query Elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span> The unit can be anything from weeks to seconds</span>
<span class="pl-ent">run_every</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">1</span>

<span class="pl-c"><span class="pl-c">#</span> ElastAlert will buffer results from the most recent</span>
<span class="pl-c"><span class="pl-c">#</span> period of time, in case some log sources are not in real time</span>
<span class="pl-ent">buffer_time</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">15</span>

<span class="pl-c"><span class="pl-c">#</span> The Elasticsearch hostname for metadata writeback</span>
<span class="pl-c"><span class="pl-c">#</span> Note that every rule can have its own Elasticsearch host</span>
<span class="pl-ent">es_host</span>: <span class="pl-s">10.1.1.30</span>

<span class="pl-c"><span class="pl-c">#</span> The Elasticsearch port</span>
<span class="pl-ent">es_port</span>: <span class="pl-c1">9200</span>

<span class="pl-c"><span class="pl-c">#</span> The AWS region to use. Set this when using AWS-managed elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span>aws_region: us-east-1</span>

<span class="pl-c"><span class="pl-c">#</span> The AWS profile to use. Use this if you are using an aws-cli profile.</span>
<span class="pl-c"><span class="pl-c">#</span> See http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html</span>
<span class="pl-c"><span class="pl-c">#</span> for details</span>
<span class="pl-c"><span class="pl-c">#</span>profile: test</span>

<span class="pl-c"><span class="pl-c">#</span> Optional URL prefix for Elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span>es_url_prefix: elasticsearch</span>

<span class="pl-c"><span class="pl-c">#</span> Optional prefix for statsd metrics</span>
<span class="pl-c"><span class="pl-c">#</span>statsd_instance_tag: elastalert</span>

<span class="pl-c"><span class="pl-c">#</span> Optional statsd host</span>
<span class="pl-c"><span class="pl-c">#</span>statsd_host: dogstatsd</span>

<span class="pl-c"><span class="pl-c">#</span> Connect with TLS to Elasticsearch</span>
<span class="pl-c"><span class="pl-c">#</span>use_ssl: True</span>

<span class="pl-c"><span class="pl-c">#</span> Verify TLS certificates</span>
<span class="pl-c"><span class="pl-c">#</span>verify_certs: True</span>

<span class="pl-c"><span class="pl-c">#</span> Show TLS or certificate related warnings</span>
<span class="pl-c"><span class="pl-c">#</span>ssl_show_warn: True</span>

<span class="pl-c"><span class="pl-c">#</span> GET request with body is the default option for Elasticsearch.</span>
<span class="pl-c"><span class="pl-c">#</span> If it fails for some reason, you can pass 'GET', 'POST' or 'source'.</span>
<span class="pl-c"><span class="pl-c">#</span> See https://elasticsearch-py.readthedocs.io/en/master/connection.html?highlight=send_get_body_as#transport</span>
<span class="pl-c"><span class="pl-c">#</span> for details</span>
<span class="pl-c"><span class="pl-c">#</span>es_send_get_body_as: GET</span>

<span class="pl-c"><span class="pl-c">#</span> Option basic-auth username and password for Elasticsearch</span>
<span class="pl-ent">es_username</span>: <span class="pl-s">elastic</span>
<span class="pl-ent">es_password</span>: <span class="pl-s">elastic</span>

<span class="pl-c"><span class="pl-c">#</span> Use SSL authentication with client certificates client_cert must be</span>
<span class="pl-c"><span class="pl-c">#</span> a pem file containing both cert and key for client</span>
<span class="pl-c"><span class="pl-c">#</span>ca_certs: /path/to/cacert.pem</span>
<span class="pl-c"><span class="pl-c">#</span>client_cert: /path/to/client_cert.pem</span>
<span class="pl-c"><span class="pl-c">#</span>client_key: /path/to/client_key.key</span>

<span class="pl-c"><span class="pl-c">#</span> The index on es_host which is used for metadata storage</span>
<span class="pl-c"><span class="pl-c">#</span> This can be a unmapped index, but it is recommended that you run</span>
<span class="pl-c"><span class="pl-c">#</span> elastalert-create-index to set a mapping</span>
<span class="pl-ent">writeback_index</span>: <span class="pl-s">elastalert_status</span>

<span class="pl-c"><span class="pl-c">#</span> If an alert fails for some reason, ElastAlert will retry</span>
<span class="pl-c"><span class="pl-c">#</span> sending the alert until this time period has elapsed</span>
<span class="pl-ent">alert_time_limit</span>:
  <span class="pl-ent">days</span>: <span class="pl-c1">2</span>

<span class="pl-c"><span class="pl-c">#</span> å¯é€‰çš„æ—¶é—´æˆ³æ ¼å¼ã€‚</span>
<span class="pl-c"><span class="pl-c">#</span> ElastAlertå°†ä½¿ç”¨æ­¤æ ¼å¼åœ¨è­¦æŠ¥æ¶ˆæ¯å’Œæ—¥å¿—æ¶ˆæ¯ä¸­æ‰“å°æ—¶é—´æˆ³ã€‚</span>
<span class="pl-ent">custom_pretty_ts_format</span>: <span class="pl-s"><span class="pl-pds">'</span>%Y-%m-%d %H:%M<span class="pl-pds">'</span></span>

<span class="pl-c"><span class="pl-c">#</span> è‡ªå®šä¹‰æ—¥å¿—é…ç½®</span>
<span class="pl-c"><span class="pl-c">#</span> å¦‚æœæ‚¨å¸Œæœ›è®¾ç½®è‡ªå·±çš„æ—¥å¿—é…ç½®ä»¥è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è®°å½•åˆ°Logstashï¼Œå¹¶ä¸”/æˆ–è€…ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„é…ç½®å¹¶æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚</span>
<span class="pl-c"><span class="pl-c">#</span> æ³¨æ„ï¼šå¦‚æœæ‚¨ä»¥--verbose/--debugè¿è¡ŒElastAlertï¼Œâ€œelastalertâ€è®°å½•å™¨çš„æ—¥å¿—çº§åˆ«å°†æ›´æ”¹ä¸ºINFOï¼Œå¦‚æœå®ƒè¿˜ä¸æ˜¯INFO/DEBUGã€‚</span>
<span class="pl-ent">logging</span>:
 <span class="pl-ent">version</span>: <span class="pl-c1">1</span>
 <span class="pl-ent">incremental</span>: <span class="pl-c1">false</span>
 <span class="pl-ent">disable_existing_loggers</span>: <span class="pl-c1">false</span>
 <span class="pl-ent">formatters</span>:
   <span class="pl-ent">logline</span>:
     <span class="pl-ent">format</span>: <span class="pl-s"><span class="pl-pds">'</span>%(asctime)s %(levelname)+8s %(name)+20s %(message)s<span class="pl-pds">'</span></span>

 <span class="pl-ent">handlers</span>:
   <span class="pl-ent">console</span>:
     <span class="pl-ent">class</span>: <span class="pl-s">logging.StreamHandler</span>
     <span class="pl-ent">formatter</span>: <span class="pl-s">logline</span>
     <span class="pl-ent">level</span>: <span class="pl-s">DEBUG</span>
     <span class="pl-ent">stream</span>: <span class="pl-s">ext://sys.stderr</span>

   <span class="pl-ent">file</span>:
     <span class="pl-ent">class </span>: <span class="pl-s">logging.FileHandler</span>
     <span class="pl-ent">formatter</span>: <span class="pl-s">logline</span>
     <span class="pl-ent">level</span>: <span class="pl-s">DEBUG</span>
     <span class="pl-ent">filename</span>: <span class="pl-s">elastalert.log</span>

 <span class="pl-ent">loggers</span>:
   <span class="pl-ent">elastalert</span>:
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>: <span class="pl-s">[]</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">true</span>

   <span class="pl-ent">elasticsearch</span>:
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>: <span class="pl-s">[]</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">true</span>

   <span class="pl-ent">elasticsearch.trace</span>:
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>: <span class="pl-s">[]</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">true</span>

   <span class="pl-s"><span class="pl-pds">'</span><span class="pl-pds">'</span></span>:  <span class="pl-c"><span class="pl-c">#</span> æ ¹è®°å½•å™¨</span>
     <span class="pl-ent">level</span>: <span class="pl-s">WARN</span>
     <span class="pl-ent">handlers</span>:
       - <span class="pl-s">console</span>
       - <span class="pl-s">file</span>
     <span class="pl-ent">propagate</span>: <span class="pl-c1">false</span></pre></div>
<p><code class="notranslate">nginx-rules.yaml</code></p>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">"</span>Nginx-Error<span class="pl-pds">"</span></span>
<span class="pl-ent">type</span>: <span class="pl-s"><span class="pl-pds">"</span>frequency<span class="pl-pds">"</span></span>
<span class="pl-ent">index</span>: <span class="pl-s"><span class="pl-pds">"</span>nginx-error-8.13.2*<span class="pl-pds">"</span></span>  <span class="pl-c"><span class="pl-c">#</span> æŸ¥è¯¢æ—¥å¿—æ‰€åœ¨çš„ç´¢å¼•</span>
<span class="pl-ent">is_enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">num_events</span>: <span class="pl-c1">3</span>  <span class="pl-c"><span class="pl-c">#</span> äº‹ä»¶å‡ºç°çš„æ¬¡æ•°</span>
<span class="pl-ent">timeframe</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">2</span>   <span class="pl-c"><span class="pl-c">#</span> 1åˆ†é’Ÿå†…å‡ºç°äº†num_eventså‡ æ¬¡å°±æŠ¥è­¦</span>
<span class="pl-ent">realert</span>:
  <span class="pl-ent">minutes</span>: <span class="pl-c1">180</span>   <span class="pl-c"><span class="pl-c">#</span> 5åˆ†é’Ÿå†…å¿½ç•¥é‡å¤å‘Šè­¦</span>
<span class="pl-ent">timestamp_field</span>: <span class="pl-s"><span class="pl-pds">"</span>@timestamp<span class="pl-pds">"</span></span>
<span class="pl-ent">timestamp_type</span>: <span class="pl-s"><span class="pl-pds">"</span>iso<span class="pl-pds">"</span></span>
<span class="pl-ent">use_strftime_index</span>: <span class="pl-c1">true</span>
<span class="pl-ent">filter</span>:
  - <span class="pl-ent">query</span>:
      <span class="pl-ent">query_string</span>:
        <span class="pl-ent">query</span>: <span class="pl-s"><span class="pl-pds">"</span>message:<span class="pl-cce">\"</span>error<span class="pl-cce">\"</span> NOT message:<span class="pl-cce">\"</span>No such file or directory<span class="pl-cce">\"</span> NOT message:<span class="pl-cce">\"</span>forbidden by rule<span class="pl-cce">\"</span><span class="pl-pds">"</span></span>  <span class="pl-c"><span class="pl-c">#</span> å‘Šè­¦æŸ¥è¯¢è¯­å¥</span>

<span class="pl-ent">alert_text_type</span>: <span class="pl-s">alert_text_only</span>
<span class="pl-ent">alert_text</span>: <span class="pl-s"><span class="pl-pds">"</span>### Nginx-Error(Prod)æ—¥å¿—å‘Šè­¦<span class="pl-cce">\n</span>- **é‡‡é›†ä½ç½®:** {0}<span class="pl-cce">\n</span>- **æ–‡ä»¶:** {1}<span class="pl-cce">\n</span>- **åŒ¹é…æ¬¡æ•°:** {2}<span class="pl-cce">\n</span>- **æ—¥å¿—id:** {3}<span class="pl-cce">\n\n</span>- [ç‚¹æˆ‘å»æŸ¥è¯¢]()<span class="pl-pds">"</span></span>
<span class="pl-c"><span class="pl-c">#</span> ä¸Šè¿°æ‹¬å·ä¸­å¡«å†™æŸ¥è¯¢é“¾æ¥</span>
<span class="pl-ent">alert_text_args</span>:   <span class="pl-c"><span class="pl-c">#</span> å‘Šè­¦æ¨¡æ¿ä¸­ç”¨åˆ°çš„å‚æ•°</span>
  - <span class="pl-s">agent.name</span>
  - <span class="pl-s"><span class="pl-pds">"</span>log.file.path<span class="pl-pds">"</span></span>
  - <span class="pl-s">num_matches</span>
  - <span class="pl-s">_id</span>
  - <span class="pl-s">_id</span>

<span class="pl-ent">alert</span>:
  - <span class="pl-s"><span class="pl-pds">"</span>dingtalk<span class="pl-pds">"</span></span>
<span class="pl-ent">dingtalk_access_token</span>: <span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
<span class="pl-ent">dingtalk_msgtype</span>: <span class="pl-s"><span class="pl-pds">"</span>markdown<span class="pl-pds">"</span></span></pre></div>
<h4>Enhancementsè‡ªå®šä¹‰å¼€å‘&amp;é•œåƒæ„å»º</h4>
<div class="markdown-alert markdown-alert-tip"><p class="markdown-alert-title"><svg class="octicon octicon-light-bulb mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z"></path></svg>Tip</p>
<p>åˆå§‹åŒ–æµç¨‹å¯ä»¥æŒ‰ç…§å®˜æ–¹[<a href="https://elastalert.readthedocs.io/en/latest/recipes/adding_enhancements.html" rel="nofollow">æ–‡æ¡£</a>](<a href="https://elastalert.readthedocs.io/en/latest/recipes/adding_enhancements.html)%E8%BF%9B%E8%A1%8C" rel="nofollow">https://elastalert.readthedocs.io/en/latest/recipes/adding_enhancements.html)è¿›è¡Œ</a></p>
</div>
<p>Exampleï¼šRubyæ—¥å¿—æ ¼å¼åŒ¹é…æå–request-id</p>
<p>åˆ›å»ºæ–‡ä»¶å¤¹</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">mkdir elastalert/elastalert_modules
touch __init__.py extract_request_id.py</pre></div>
<p><code class="notranslate">extract_request_id.py</code></p>
<div class="highlight highlight-source-python"><pre class="notranslate"><span class="pl-k">from</span> <span class="pl-s1">elastalert</span>.<span class="pl-s1">enhancements</span> <span class="pl-k">import</span> <span class="pl-v">BaseEnhancement</span>
<span class="pl-k">import</span> <span class="pl-s1">re</span>

<span class="pl-k">class</span> <span class="pl-v">Extract_Requestid</span>(<span class="pl-v">BaseEnhancement</span>):
    <span class="pl-k">def</span> <span class="pl-en">process</span>(<span class="pl-s1">self</span>, <span class="pl-s1">match</span>):
        <span class="pl-c"># å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼</span>
        <span class="pl-s1">pattern</span> <span class="pl-c1">=</span> <span class="pl-s">r"\b[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\b"</span>
        <span class="pl-c"># æ£€æŸ¥ 'message' å­—æ®µæ˜¯å¦å­˜åœ¨äºmatchä¸­</span>
        <span class="pl-k">if</span> <span class="pl-s">'message'</span> <span class="pl-c1">in</span> <span class="pl-s1">match</span>:
            <span class="pl-s1">log_message</span> <span class="pl-c1">=</span> <span class="pl-s1">match</span>[<span class="pl-s">'message'</span>]
            <span class="pl-s1">match_obj</span> <span class="pl-c1">=</span> <span class="pl-s1">re</span>.<span class="pl-en">search</span>(<span class="pl-s1">pattern</span>, <span class="pl-s1">log_message</span>)
            <span class="pl-k">if</span> <span class="pl-s1">match_obj</span>:
                <span class="pl-s1">match</span>[<span class="pl-s">'extract_requestid'</span>] <span class="pl-c1">=</span> <span class="pl-s1">match_obj</span>.<span class="pl-en">group</span>(<span class="pl-c1">0</span>)
            <span class="pl-k">else</span>:
                <span class="pl-s1">match</span>[<span class="pl-s">'extract_requestid'</span>] <span class="pl-c1">=</span> <span class="pl-s">"request id not found"</span></pre></div>
<h3>docker compose éƒ¨ç½²</h3>
<h4>ç”Ÿäº§ç«¯</h4>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">services</span>:
  <span class="pl-ent">filebeat</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/filebeat:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">filebeat</span>
    <span class="pl-ent">user</span>: <span class="pl-s">root</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span>
      - <span class="pl-s">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
      - <span class="pl-s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      - <span class="pl-s">./data:/usr/share/filebeat/data:rw</span>
      - <span class="pl-s">/home:/home</span>
      - <span class="pl-s">/var/log:/var/log</span></pre></div>
<h4>æ¶ˆè´¹ç«¯</h4>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">networks</span>:
  <span class="pl-ent">logstack</span>:
    <span class="pl-ent">name</span>: <span class="pl-s">logstack</span>
    <span class="pl-ent">driver</span>: <span class="pl-s">bridge</span>

<span class="pl-ent">services</span>:
  <span class="pl-ent">filebeat</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/filebeat:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">filebeat</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>5067:5067<span class="pl-pds">"</span></span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./filebeat/filebeat.docker.yml:/usr/share/filebeat/filebeat.yml</span>
      - <span class="pl-s">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
      - <span class="pl-s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      - <span class="pl-s">./filebeat/data:/usr/share/filebeat/data:rw</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">elasticsearch</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/elasticsearch:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">elasticsearch</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">environment</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>ES_JAVA_OPTS=-Xms6144m -Xmx6144m<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>cluster.name=elasticsearch<span class="pl-pds">"</span></span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./elasticsearch/data:/usr/share/elasticsearch/data</span>
      - <span class="pl-s">./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>9200:9200<span class="pl-pds">"</span></span>
      - <span class="pl-s"><span class="pl-pds">"</span>9300:9300<span class="pl-pds">"</span></span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">kibana</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/kibana:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">kibana</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml</span>
      - <span class="pl-s">./kibana/certs:/usr/share/kibana/config/certs</span>
    <span class="pl-ent">ports</span>:
      - <span class="pl-s"><span class="pl-pds">"</span>5601:5601<span class="pl-pds">"</span></span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">elasticsearch</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">metricbeat</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">elastic/metricbeat:8.13.2</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">metricbeat</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./metricbeat/metricbeat.docker.yml:/usr/share/metricbeat/metricbeat.yml:ro</span>
      - <span class="pl-s">/var/run/docker.sock:/var/run/docker.sock:ro</span>
      - <span class="pl-s">/sys/fs/cgroup:/hostfs/sys/fs/cgroup:ro</span>
      - <span class="pl-s">/proc:/hostfs/proc:ro</span>
      - <span class="pl-s">/:/hostfs:ro</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>

  <span class="pl-ent">esalert</span>:
    <span class="pl-ent">image</span>: <span class="pl-s">jertel/elastalert2:2.18.0</span>
    <span class="pl-ent">container_name</span>: <span class="pl-s">esalert</span>
    <span class="pl-ent">restart</span>: <span class="pl-s">unless-stopped</span>
    <span class="pl-ent">user</span>: <span class="pl-s">root</span>
    <span class="pl-ent">volumes</span>:
      - <span class="pl-s">./esalert/config.yaml:/opt/elastalert/config.yaml</span>
      - <span class="pl-s">./esalert/rules:/opt/elastalert/rules</span>
    <span class="pl-ent">depends_on</span>:
      - <span class="pl-s">elasticsearch</span>
    <span class="pl-ent">networks</span>:
      - <span class="pl-s">logstack</span>
    <span class="pl-ent">environment</span>:
      <span class="pl-ent">TZ</span>: <span class="pl-s"><span class="pl-pds">"</span>Asia/Shanghai<span class="pl-pds">"</span></span></pre></div>
<h2>éç»“æ„åŒ–æ—¥å¿—(æœªæµ‹è¯•)</h2>
<h3>filebeat 1</h3>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-ent">filebeat.inputs</span>:
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span><span class="pl-c"><span class="pl-c">#</span>æ–°ç‰ˆæœ¬å¸¸ç”¨æ–‡ä»¶æµè¾“å…¥æ–¹å¼</span>
  <span class="pl-ent">id</span>: <span class="pl-s">my-filestream-id </span><span class="pl-c"><span class="pl-c">#</span>æ¯ä¸ªæ–‡ä»¶æµè¾“å…¥å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„ IDã€‚çœç•¥æˆ–æ›´æ”¹æ–‡ä»¶æµ ID å¯èƒ½ä¼šå¯¼è‡´æ•°æ®é‡å¤ã€‚å¦‚æœæ²¡æœ‰å”¯ä¸€çš„ IDï¼Œfilestream æ— æ³•æ­£ç¡®è·Ÿè¸ªæ–‡ä»¶çš„çŠ¶æ€ã€‚</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s">/var/log/messages</span>
    - <span class="pl-s">/var/log/*.log</span>
    
- <span class="pl-ent">type</span>: <span class="pl-s">filestream </span>
  <span class="pl-ent">id</span>: <span class="pl-s">apache-filestream-id</span>
  <span class="pl-ent">paths</span>:
    - <span class="pl-s"><span class="pl-pds">"</span>/var/log/apache2/*<span class="pl-pds">"</span></span>
  <span class="pl-ent">fields</span>:
    <span class="pl-ent">apache</span>: <span class="pl-s">true </span><span class="pl-c"><span class="pl-c">#</span>fieldså­—æ®µéšåä¼šè¢«å­˜å‚¨åœ¨esä¸­é€šè¿‡kibanaè¿›è¡ŒæŸ¥è¯¢ï¼Œä¾¿äºè¯†åˆ«è¿™äº›æ—¥å¿—æ•°æ®æ¥æºäºApacheæœåŠ¡ï¼›</span>
    
    
<span class="pl-c"><span class="pl-c">#</span>è¾“å‡ºåˆ°kafka æ­¤è¾“å‡ºå¯ä»¥è¿æ¥åˆ° Kafka 0.8.2.0 åŠæ›´é«˜ç‰ˆæœ¬</span>
<span class="pl-ent">output.kafka</span>:
  <span class="pl-c"><span class="pl-c">#</span>ç”¨äºè¯»å–é›†ç¾¤å…ƒæ•°æ®çš„brokers</span>
  <span class="pl-ent">hosts</span>: <span class="pl-s">["kafka1:9092", "kafka2:9092", "kafka3:9092"]</span>
  <span class="pl-c"><span class="pl-c">#</span>æ¶ˆæ¯ä¸»é¢˜é€‰æ‹©+åˆ†åŒº</span>
  <span class="pl-ent">topic</span>: <span class="pl-s"><span class="pl-pds">'</span>%{[fields.log_topic]}<span class="pl-pds">'</span></span>
  <span class="pl-ent">partition.round_robin</span>:
    <span class="pl-ent">reachable_only</span>: <span class="pl-c1">false</span>

  <span class="pl-ent">required_acks</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">compression</span>: <span class="pl-s">gzip</span>
  <span class="pl-ent">max_message_bytes</span>: <span class="pl-c1">1000000</span> <span class="pl-c"><span class="pl-c">#</span>å¤§äº max_message_bytes çš„äº‹ä»¶å°†è¢«ä¸¢å¼ƒ</span></pre></div>
<h3>kafka</h3>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span>æš‚å®š</span></pre></div>
<h3>logstash</h3>
<pre lang="conf" class="notranslate"><code class="notranslate">input {
  kafka {
    id =&gt; "my-kafka-consumer" # å”¯ä¸€æ ‡è¯†æ­¤Kafkaæ¶ˆè´¹è€…
    topics =&gt; ["my-topic"] # Kafkaä¸»é¢˜åˆ—è¡¨
    topic_id =&gt; "%{topic}" # ç”¨äºæ ‡è¯†æ¶ˆæ¯æ¥è‡ªå“ªä¸ªä¸»é¢˜
    group_id =&gt; "my-consumer-group" # Kafkaæ¶ˆè´¹è€…ç»„ID
    bootstrap_servers =&gt; "localhost:9092" # KafkaæœåŠ¡å™¨åœ°å€
    # å…¶ä»–å¯é€‰é…ç½®
    auto_offset_reset =&gt; "earliest" # å½“æ²¡æœ‰åˆå§‹åç§»é‡æ—¶ï¼Œä»æœ€æ—©çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹
    enable_auto_commit =&gt; true # è‡ªåŠ¨æäº¤åç§»é‡
    max_poll_records =&gt; 500 # æ¯æ¬¡è½®è¯¢è·å–çš„æœ€å¤§è®°å½•æ•°
    max_poll_interval_ms =&gt; 300000 # è½®è¯¢é—´éš”çš„æœ€å¤§æ¯«ç§’æ•°
  }
}

filter {
  # åœ¨è¿™é‡Œæ·»åŠ ä»»ä½•ä½ éœ€è¦çš„è¿‡æ»¤æˆ–æ•°æ®è½¬æ¢æ“ä½œ
  # ä¾‹å¦‚ï¼Œä½¿ç”¨grokæ’ä»¶è§£ææ—¥å¿—æ ¼å¼
  grok {
    match =&gt; { "message" =&gt; "%{TIMESTAMP_ISO8601:timestamp} %{LOGLEVEL:level} %{WORD:thread} %{GREEDYDATA:message}" }
  }
  date {
    match =&gt; ["timestamp", "ISO8601"] # è½¬æ¢æ—¶é—´æˆ³æ ¼å¼
  }
  mutate {
    lowercase =&gt; ["level"] # å°†æ—¥å¿—çº§åˆ«è½¬æ¢ä¸ºå°å†™
  }
}

output {
  elasticsearch {
    hosts =&gt; ["https://...] 
    cacert =&gt; '/etc/logstash/config/certs/ca.crt' 
  }
}
</code></pre>
<h1>ESç´¢å¼•ç”Ÿå‘½å‘¨æœŸ</h1>
<h2>ä»¥ä¸‹é¢çš„é¡ºåºæ¥é…ç½®</h2>
<h3>Kibana</h3>
<ol>
<li>
<p>ç‚¹å‡»ç®¡ç†-&gt;ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç­–ç•¥-&gt;åˆ›å»ºç­–ç•¥ï¼Œé€‰æ‹©éœ€è¦çš„é˜¶æ®µå’Œåœ¨å¤šå°‘å¤©ååˆ é™¤è¯¥æ•°æ®ï¼›</p>
</li>
<li>
<p>ç‚¹å‡»ç®¡ç†-&gt;ç´¢å¼•ç®¡ç†-&gt;ç´¢å¼•æ¨¡æ¿-&gt;åˆ›å»ºæ¨¡æ¿ï¼š</p>
<ul>
<li>
<p>åç§°ä¿®æ”¹å®Œè²Œä¼¼æ˜¯ä¸å¯é‡æ–°ç¼–è¾‘çš„ï¼›</p>
</li>
<li>
<p>ç´¢å¼•æ¨¡å¼å¯ä»¥ä»¥é€šé…ç¬¦'*'çš„æ–¹å¼æ¥åŒ¹é…éœ€è¦çš„ç´¢å¼•ï¼Œé¦–æ¬¡å»ºè®®ä½¿ç”¨ä¸€ä¸ªè¿›è¡Œæµ‹è¯•ï¼›</p>
</li>
<li>
<p>æ•°æ®æµä¸è¦åˆ›å»ºï¼›</p>
</li>
<li>
<p>æ‰“å¼€ä¸‹é¢çš„<strong>å…è®¸è‡ªåŠ¨åˆ›å»º</strong>ï¼›</p>
</li>
<li>
<p><strong>ç´¢å¼•è®¾ç½®</strong>å¯ä»¥å¯¹ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç­–ç•¥è¿›è¡Œå…³è”ï¼š</p>
<div class="highlight highlight-source-json"><pre class="notranslate">{
  <span class="pl-ent">"index"</span>: {
    <span class="pl-ent">"lifecycle"</span>: {
      <span class="pl-ent">"name"</span>: <span class="pl-s"><span class="pl-pds">"</span>log-rotate<span class="pl-pds">"</span></span>
    }
  }
}</pre></div>
</li>
<li>
<p><strong>æ˜ å°„</strong>å¯ä»¥ä»å·²ç»å­˜åœ¨çš„ç´¢å¼•å½“ä¸­å¤åˆ¶jsonåˆ°è¿™é‡Œç²˜è´´è¿›è¡Œç¼–è¾‘ï¼›</p>
</li>
</ul>
</li>
</ol>
<h3>Filebeat</h3>
<blockquote>
<p>è¿™é‡Œçš„filebeatä¸ºæ¶ˆè´¹kafkaåå°†æ—¥å¿—æ¶ˆæ¯å­˜å‚¨åˆ°Elasticsearchä¸­çš„filebeatå®ä¾‹ï¼Œä¸»è¦çœ‹é…ç½®æ–‡ä»¶å˜åŒ–</p>
</blockquote>
<div class="highlight highlight-source-yaml"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä¸­å¼€å¯å¯¹åº”çš„é…ç½®å°±å¯ä»¥</span>
<span class="pl-ent">setup.ilm.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.ilm.policy_name</span>: <span class="pl-s"><span class="pl-pds">"</span>log-rotate<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.enabled</span>: <span class="pl-c1">false</span>
<span class="pl-ent">setup.template.overwrite</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.template.json.enabled</span>: <span class="pl-c1">true</span>
<span class="pl-ent">setup.template.name</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.pattern</span>: <span class="pl-s"><span class="pl-pds">"</span>filebeat-%{[agent.version]}-*<span class="pl-pds">"</span></span>
<span class="pl-ent">setup.template.settings</span>:
  <span class="pl-ent">index.number_of_shards</span>: <span class="pl-c1">1</span>
  <span class="pl-ent">index.number_of_replicas</span>: <span class="pl-c1">0</span></pre></div>
<h1></h1>
<h1>é—®é¢˜</h1>
<ol>
<li>
<p>this action would add [2] shards, but this cluster currently has [1000]/[1000] maximum normal shards openï¼šesåˆ†ç‰‡æ•°é‡è¶…é™</p>
<pre class="notranslate"><code class="notranslate">PUT /_cluster/settings
{
  "persistent": {
    "cluster": {
      "max_shards_per_node":10000
    }
  }
}

#æŸ¥è¯¢
GET /_cluster/settings?pretty
</code></pre>
</li>
</ol></div>
<div style="font-size:small;margin-top:8px;float:right;">ğŸºè½¬è½½æ–‡ç« è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼ğŸº</div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">è¯„è®º</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright Â© <span id="copyrightYear"></span> <a href="https://blog.witter.top">V's Blog</a></div>
<div id="footer2"><span id="filingNum"><a href="https://beian.miit.gov.cn/" target="_blank">å†€ICPå¤‡2022019998å·</a> â€¢ </span>
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if("06/20/2024"!=""){
    var startSite=new Date("06/20/2024");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","ljwtorch/ljwtorch.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>
<script defer src="http://ssh.witter.top:10012/script.js" data-website-id="b891c729-62b4-46cb-bdca-d622dc706106"></script>

</html>
