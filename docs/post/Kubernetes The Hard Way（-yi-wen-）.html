<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="//cdn.staticfile.net/Primer/21.0.7/primer.css" rel="stylesheet" />
    <link rel="icon" href="https://img.witter.top/file/b037878209903b7d5bb17.jpg"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="> [!IMPORTANT]
> [GitHubåŸæ–‡é“¾æ¥](https://github.com/kelseyhightower/kubernetes-the-hard-way) æœ¬æ–‡ä½¿ç”¨ChatGPTååŠ©ç¿»è¯‘

# å…ˆå†³æ¡ä»¶

åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†å›é¡¾è·Ÿéšæœ¬æ•™ç¨‹æ‰€éœ€çš„æœºå™¨è¦æ±‚ã€‚">
<meta property="og:title" content="Kubernetes The Hard Wayï¼ˆè¯‘æ–‡ï¼‰">
<meta property="og:description" content="> [!IMPORTANT]
> [GitHubåŸæ–‡é“¾æ¥](https://github.com/kelseyhightower/kubernetes-the-hard-way) æœ¬æ–‡ä½¿ç”¨ChatGPTååŠ©ç¿»è¯‘

# å…ˆå†³æ¡ä»¶

åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†å›é¡¾è·Ÿéšæœ¬æ•™ç¨‹æ‰€éœ€çš„æœºå™¨è¦æ±‚ã€‚">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.witter.top/post/Kubernetes%20The%20Hard%20Way%EF%BC%88-yi-wen-%EF%BC%89.html">
<meta property="og:image" content="https://img.witter.top/file/b037878209903b7d5bb17.jpg">
<title>Kubernetes The Hard Wayï¼ˆè¯‘æ–‡ï¼‰</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />

</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
</style>
<style>.markdown-alert{padding:0.5rem 1rem;margin-bottom:1rem;border-left:.25em solid var(--borderColor-default,var(--color-border-default));}.markdown-alert .markdown-alert-title {display:flex;font-weight:var(--base-text-weight-medium,500);align-items:center;line-height:1;}.markdown-alert>:first-child {margin-top:0;}.markdown-alert>:last-child {margin-bottom:0;}</style><style>.markdown-alert.markdown-alert-important {border-left-color:var(--borderColor-done-emphasis, var(--color-done-emphasis));background-color:var(--color-done-subtle);}.markdown-alert.markdown-alert-important .markdown-alert-title {color: var(--fgColor-done,var(--color-done-fg));}</style>



<body>
    <div id="header">
<h1 class="postTitle">Kubernetes The Hard Wayï¼ˆè¯‘æ–‡ï¼‰</h1>
<div class="title-right">
    <a href="https://blog.witter.top" id="buttonHome" class="btn btn-invisible circle" title="é¦–é¡µ">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/ljwtorch/ljwtorch.github.io/issues/20" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="åˆ‡æ¢ä¸»é¢˜">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><div class="markdown-alert markdown-alert-important"><p class="markdown-alert-title"><svg class="octicon octicon-report mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0 1 14.25 13H8.06l-2.573 2.573A1.458 1.458 0 0 1 3 14.543V13H1.75A1.75 1.75 0 0 1 0 11.25Zm1.75-.25a.25.25 0 0 0-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h6.5a.25.25 0 0 0 .25-.25v-9.5a.25.25 0 0 0-.25-.25Zm7 2.25v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 9a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"></path></svg>Important</p><p><a href="https://github.com/kelseyhightower/kubernetes-the-hard-way">GitHubåŸæ–‡é“¾æ¥</a> æœ¬æ–‡ä½¿ç”¨ChatGPTååŠ©ç¿»è¯‘</p>
</div>
<h1>å…ˆå†³æ¡ä»¶</h1>
<p>åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†å›é¡¾è·Ÿéšæœ¬æ•™ç¨‹æ‰€éœ€çš„æœºå™¨è¦æ±‚ã€‚</p>
<h2>è™šæ‹Ÿæˆ–ç‰©ç†æœºå™¨</h2>
<p>æœ¬æ•™ç¨‹éœ€è¦å››ï¼ˆ4ï¼‰å°è¿è¡ŒDebian 12ï¼ˆbookwormï¼‰çš„è™šæ‹Ÿæˆ–ç‰©ç†ARM64æœºå™¨ã€‚ä¸‹è¡¨åˆ—å‡ºäº†å››å°æœºå™¨åŠå…¶CPUã€å†…å­˜å’Œå­˜å‚¨è¦æ±‚ã€‚</p>
<table role="table">
<thead>
<tr>
<th>åç§°</th>
<th>æè¿°</th>
<th>CPU</th>
<th>å†…å­˜</th>
<th>å­˜å‚¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>jumpbox</td>
<td>ç®¡ç†ä¸»æœº</td>
<td>1</td>
<td>512MB</td>
<td>10GB</td>
</tr>
<tr>
<td>server</td>
<td>KubernetesæœåŠ¡å™¨</td>
<td>1</td>
<td>2GB</td>
<td>20GB</td>
</tr>
<tr>
<td>node-0</td>
<td>Kuberneteså·¥ä½œèŠ‚ç‚¹</td>
<td>1</td>
<td>2GB</td>
<td>20GB</td>
</tr>
<tr>
<td>node-1</td>
<td>Kuberneteså·¥ä½œèŠ‚ç‚¹</td>
<td>1</td>
<td>2GB</td>
<td>20GB</td>
</tr>
</tbody>
</table>
<p>å¦‚ä½•é…ç½®è¿™äº›æœºå™¨ç”±æ‚¨å†³å®šï¼Œå”¯ä¸€çš„è¦æ±‚æ˜¯æ¯å°æœºå™¨å¿…é¡»ç¬¦åˆä¸Šè¿°ç³»ç»Ÿè¦æ±‚ï¼ŒåŒ…æ‹¬æœºå™¨è§„æ ¼å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬ã€‚ä¸€æ—¦æ‚¨é…ç½®å¥½æ‰€æœ‰å››å°æœºå™¨ï¼Œé€šè¿‡åœ¨æ¯å°æœºå™¨ä¸Šè¿è¡Œ <code class="notranslate">uname</code> å‘½ä»¤æ¥éªŒè¯ç³»ç»Ÿè¦æ±‚ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">uname -mov</pre></div>
<p>è¿è¡Œ <code class="notranslate">uname</code> å‘½ä»¤åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span>1 SMP Debian 6.1.55-1 (2023-09-29) aarch64 GNU/Linux</span></pre></div>
<p>æ‚¨å¯èƒ½ä¼šæƒŠè®¶åœ°çœ‹åˆ° <code class="notranslate">aarch64</code>ï¼Œä½†è¿™æ˜¯Armæ¶æ„64ä½æŒ‡ä»¤é›†çš„æ­£å¼åç§°ã€‚æ‚¨ç»å¸¸ä¼šçœ‹åˆ°Appleå’ŒLinuxå†…æ ¸ç»´æŠ¤è€…åœ¨æåˆ°å¯¹<code class="notranslate">aarch64</code>çš„æ”¯æŒæ—¶ä½¿ç”¨<code class="notranslate">arm64</code>ã€‚æœ¬æ•™ç¨‹å°†å§‹ç»ˆä½¿ç”¨<code class="notranslate">arm64</code>ä»¥é¿å…æ··æ·†ã€‚</p>
<h1>è®¾ç½®Jumpbox</h1>
<p>åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†è®¾ç½®å››å°æœºå™¨ä¹‹ä¸€ä¸º<code class="notranslate">jumpbox</code>ã€‚è¿™å°æœºå™¨å°†ç”¨äºåœ¨æœ¬æ•™ç¨‹ä¸­è¿è¡Œå‘½ä»¤ã€‚è™½ç„¶ä½¿ç”¨ä¸“ç”¨æœºå™¨ä»¥ç¡®ä¿ä¸€è‡´æ€§ï¼Œä½†è¿™äº›å‘½ä»¤ä¹Ÿå¯ä»¥ä»å‡ ä¹ä»»ä½•æœºå™¨è¿è¡Œï¼ŒåŒ…æ‹¬è¿è¡ŒmacOSæˆ–Linuxçš„ä¸ªäººå·¥ä½œç«™ã€‚</p>
<p>å°†<code class="notranslate">jumpbox</code>è§†ä¸ºç®¡ç†æœºå™¨ï¼Œæ‚¨å°†ä½¿ç”¨å®ƒä½œä¸ºåŸºç¡€æ¥ä»å¤´å¼€å§‹è®¾ç½®Kubernetesé›†ç¾¤ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€äº›å‘½ä»¤è¡Œå·¥å…·å¹¶å…‹éš†Kubernetes The Hard Way Gitåº“ï¼Œè¯¥åº“åŒ…å«ä¸€äº›ç”¨äºé…ç½®å„ç§Kubernetesç»„ä»¶çš„é¢å¤–é…ç½®æ–‡ä»¶ã€‚</p>
<p>ç™»å½•åˆ°<code class="notranslate">jumpbox</code>ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ssh root@jumpbox</pre></div>
<p>æ‰€æœ‰å‘½ä»¤å°†ä»¥<code class="notranslate">root</code>ç”¨æˆ·èº«ä»½è¿è¡Œã€‚è¿™æ˜¯ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå¹¶å°†å¸®åŠ©å‡å°‘è®¾ç½®æ‰€æœ‰å†…å®¹æ‰€éœ€çš„å‘½ä»¤æ•°é‡ã€‚</p>
<h3>å®‰è£…å‘½ä»¤è¡Œå·¥å…·</h3>
<p>ç°åœ¨ï¼Œæ‚¨å·²ç»ä»¥<code class="notranslate">root</code>ç”¨æˆ·èº«ä»½ç™»å½•åˆ°<code class="notranslate">jumpbox</code>æœºå™¨ï¼Œæ‚¨å°†å®‰è£…ç”¨äºåœ¨æ•´ä¸ªæ•™ç¨‹ä¸­æ‰§è¡Œå„ç§ä»»åŠ¡çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">apt-get -y install wget curl vim openssl git</pre></div>
<h3>åŒæ­¥GitHubåº“</h3>
<p>ç°åœ¨æ˜¯ä¸‹è½½æœ¬æ•™ç¨‹å‰¯æœ¬çš„æ—¶å€™äº†ï¼Œå…¶ä¸­åŒ…å«å°†ç”¨äºä»å¤´æ„å»ºKubernetesé›†ç¾¤çš„é…ç½®æ–‡ä»¶å’Œæ¨¡æ¿ã€‚ä½¿ç”¨<code class="notranslate">git</code>å‘½ä»¤å…‹éš†Kubernetes The Hard Way Gitåº“ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">git clone --depth 1 \
  https://github.com/kelseyhightower/kubernetes-the-hard-way.git</pre></div>
<p>è¿›å…¥<code class="notranslate">kubernetes-the-hard-way</code>ç›®å½•ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c1">cd</span> kubernetes-the-hard-way</pre></div>
<p>è¿™å°†æ˜¯æœ¬æ•™ç¨‹å…¶ä½™éƒ¨åˆ†çš„å·¥ä½œç›®å½•ã€‚å¦‚æœæ‚¨è¿·è·¯äº†ï¼Œè¯·è¿è¡Œ<code class="notranslate">pwd</code>å‘½ä»¤ä»¥ç¡®è®¤åœ¨<code class="notranslate">jumpbox</code>ä¸Šè¿è¡Œå‘½ä»¤æ—¶æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•ä¸­ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c1">pwd</span>
/root/kubernetes-the-hard-way</pre></div>
<h3>ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶</h3>
<p>ä¸‹è½½åˆ—åœ¨<code class="notranslate">downloads.txt</code>æ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨<code class="notranslate">wget</code>å‘½ä»¤ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">wget -q --show-progress \
  --https-only \
  --timestamping \
  -P downloads \
  -i downloads.txt</pre></div>
<p>æ ¹æ®æ‚¨çš„äº’è”ç½‘è¿æ¥é€Ÿåº¦ï¼Œä¸‹è½½<code class="notranslate">584</code>å…†å­—èŠ‚çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œä¸‹è½½å®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<code class="notranslate">ls</code>å‘½ä»¤åˆ—å‡ºå®ƒä»¬ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">ls -loh downloads

total 584M
-rw-r--r-- 1 root  41M May  9 13:35 cni-plugins-linux-arm64-v1.3.0.tgz
-rw-r--r-- 1 root  34M Oct 26 15:21 containerd-1.7.8-linux-arm64.tar.gz
-rw-r--r-- 1 root  22M Aug 14 00:19 crictl-v1.28.0-linux-arm.tar.gz
-rw-r--r-- 1 root  15M Jul 11 02:30 etcd-v3.4.27-linux-arm64.tar.gz
-rw-r--r-- 1 root 111M Oct 18 07:34 kube-apiserver
-rw-r--r-- 1 root 107M Oct 18 07:34 kube-controller-manager
-rw-r--r-- 1 root  51M Oct 18 07:34 kube-proxy
-rw-r--r-- 1 root  52M Oct 18 07:34 kube-scheduler
-rw-r--r-- 1 root  46M Oct 18 07:34 kubectl
-rw-r--r-- 1 root 101M Oct 18 07:34 kubelet
-rw-r--r-- 1 root 9.6M Aug 10 18:57 runc.arm64</pre></div>
<h3>å®‰è£…kubectl</h3>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†åœ¨<code class="notranslate">jumpbox</code>æœºå™¨ä¸Šå®‰è£…<code class="notranslate">kubectl</code>ï¼Œå³å®˜æ–¹Kuberneteså®¢æˆ·ç«¯å‘½ä»¤è¡Œå·¥å…·ã€‚åœ¨æœ¬æ•™ç¨‹åé¢æ‚¨çš„é›†ç¾¤é…ç½®å®Œæˆåï¼Œ<code class="notranslate">kubectl</code>å°†ç”¨äºä¸Kubernetesæ§åˆ¶è¿›è¡Œäº¤äº’ã€‚</p>
<p>ä½¿ç”¨<code class="notranslate">chmod</code>å‘½ä»¤ä½¿<code class="notranslate">kubectl</code>äºŒè¿›åˆ¶æ–‡ä»¶å¯æ‰§è¡Œå¹¶å°†å…¶ç§»åŠ¨åˆ°<code class="notranslate">/usr/local/bin/</code>ç›®å½•ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">{
  chmod +x downloads/kubectl
  cp downloads/kubectl /usr/local/bin/
}</pre></div>
<p>æ­¤æ—¶ï¼Œ<code class="notranslate">kubectl</code>å·²å®‰è£…ï¼Œå¯ä»¥é€šè¿‡è¿è¡Œ<code class="notranslate">kubectl</code>å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">kubectl version --client

Client Version: v1.28.3
Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3</pre></div>
<p>æ­¤æ—¶ï¼Œ<code class="notranslate">jumpbox</code>å·²å®‰è£…å®Œæˆæ‰€æœ‰å¿…è¦çš„å‘½ä»¤è¡Œå·¥å…·å’Œå®ç”¨ç¨‹åºã€‚</p>
<h1>é…ç½®è®¡ç®—èµ„æº</h1>
<p>Kubernetes éœ€è¦ä¸€ç»„æœºå™¨æ¥æ‰˜ç®¡ Kubernetes æ§åˆ¶å¹³é¢å’Œæœ€ç»ˆè¿è¡Œå®¹å™¨çš„å·¥ä½œèŠ‚ç‚¹ã€‚åœ¨æœ¬å®éªŒä¸­ï¼Œæ‚¨å°†é…ç½®è®¾ç½® Kubernetes é›†ç¾¤æ‰€éœ€çš„æœºå™¨ã€‚</p>
<h2>æœºå™¨æ•°æ®åº“</h2>
<p>æœ¬æ•™ç¨‹å°†åˆ©ç”¨ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä½œä¸ºæœºå™¨æ•°æ®åº“ï¼Œå­˜å‚¨åœ¨è®¾ç½® Kubernetes æ§åˆ¶å¹³é¢å’Œå·¥ä½œèŠ‚ç‚¹æ—¶å°†ä½¿ç”¨çš„å„ç§æœºå™¨å±æ€§ã€‚ä»¥ä¸‹æ¨¡å¼è¡¨ç¤ºæœºå™¨æ•°æ®åº“ä¸­çš„æ¡ç›®ï¼Œæ¯è¡Œä¸€ä¸ªæ¡ç›®ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">IPV4_ADDRESS FQDN HOSTNAME POD_SUBNET</pre></div>
<p>æ¯ä¸€åˆ—åˆ†åˆ«å¯¹åº”ä¸€å°æœºå™¨çš„IPåœ°å€ <code class="notranslate">IPV4_ADDRESS</code>ï¼Œå®Œå…¨é™å®šåŸŸå <code class="notranslate">FQDN</code>ï¼Œä¸»æœºå <code class="notranslate">HOSTNAME</code> å’Œ IP å­ç½‘ <code class="notranslate">POD_SUBNET</code>ã€‚Kubernetes ä¸ºæ¯ä¸ª <code class="notranslate">pod</code> åˆ†é…ä¸€ä¸ª IP åœ°å€ï¼Œ<code class="notranslate">POD_SUBNET</code> è¡¨ç¤ºåˆ†é…ç»™é›†ç¾¤ä¸­æ¯å°æœºå™¨çš„å”¯ä¸€ IP åœ°å€èŒƒå›´ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åˆ›å»ºæœ¬æ•™ç¨‹æ—¶ä½¿ç”¨çš„æœºå™¨æ•°æ®åº“ç¤ºä¾‹ã€‚è¯·æ³¨æ„ï¼ŒIP åœ°å€å·²è¢«å±è”½ã€‚åªè¦æ¯å°æœºå™¨èƒ½å¤Ÿç›¸äº’è®¿é—®ä»¥åŠè®¿é—®<code class="notranslate">jumpbox</code>ï¼Œæ‚¨çš„æœºå™¨å¯ä»¥åˆ†é…ä»»ä½• IP åœ°å€ã€‚</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">cat machines.txt

XXX.XXX.XXX.XXX server.kubernetes.local server  
XXX.XXX.XXX.XXX node-0.kubernetes.local node-0 10.200.0.0/24
XXX.XXX.XXX.XXX node-1.kubernetes.local node-1 10.200.1.0/24</pre></div>
<p>ç°åœ¨è½®åˆ°æ‚¨åˆ›å»ºä¸€ä¸ª<code class="notranslate">machines.txt</code>æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‚¨å°†ç”¨æ¥åˆ›å»º Kubernetes é›†ç¾¤çš„ä¸‰å°æœºå™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚ä½¿ç”¨ä¸Šé¢çš„ç¤ºä¾‹æœºå™¨æ•°æ®åº“ï¼Œå¹¶æ·»åŠ æ‚¨çš„æœºå™¨çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h2>é…ç½® SSH è®¿é—®</h2>
<p>SSH å°†ç”¨äºé…ç½®é›†ç¾¤ä¸­çš„æœºå™¨ã€‚è¯·éªŒè¯æ‚¨å¯¹æœºå™¨æ•°æ®åº“ä¸­åˆ—å‡ºçš„æ¯å°æœºå™¨éƒ½æœ‰ <code class="notranslate">root</code> SSH è®¿é—®æƒé™ã€‚æ‚¨å¯èƒ½éœ€è¦é€šè¿‡æ›´æ–° sshd_config æ–‡ä»¶å¹¶é‡æ–°å¯åŠ¨ SSH æœåŠ¡å™¨æ¥å¯ç”¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ root SSH è®¿é—®ã€‚</p>
<h3>å¯ç”¨ root SSH è®¿é—®</h3>
<p>å¦‚æœæ¯å°æœºå™¨ä¸Šå¯ç”¨äº† <code class="notranslate">root</code> SSH è®¿é—®ï¼Œæ‚¨åº”è¯¥å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤éªŒè¯ SSH è®¿é—®ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-k">for</span> <span class="pl-smi">host</span> <span class="pl-k">in</span> server node-0 node-1
<span class="pl-k">do</span> ssh root@<span class="pl-smi">${host}</span> uname -o -m -n
<span class="pl-k">done</span>

server aarch64 GNU/Linux
node-0 aarch64 GNU/Linux
node-1 aarch64 GNU/Linux</pre></div>
<h2>å°† DNS æ¡ç›®æ·»åŠ åˆ°æœ¬åœ°æœºå™¨</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†ä» <code class="notranslate">hosts</code> æ–‡ä»¶é™„åŠ  DNS æ¡ç›®åˆ° <code class="notranslate">jumpbox</code> æœºå™¨ä¸Šçš„æœ¬åœ° <code class="notranslate">/etc/hosts</code> æ–‡ä»¶ã€‚</p>
<p>å°† <code class="notranslate">hosts</code> æ–‡ä»¶ä¸­çš„ DNS æ¡ç›®é™„åŠ åˆ° <code class="notranslate">/etc/hosts</code>ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">cat hosts <span class="pl-k">&gt;&gt;</span> /etc/hosts</pre></div>
<p>éªŒè¯ <code class="notranslate">/etc/hosts</code> æ–‡ä»¶å·²æ›´æ–°ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">cat /etc/hosts

127.0.0.1       localhost
127.0.1.1       jumpbox

<span class="pl-c"><span class="pl-c">#</span> The following lines are desirable for IPv6 capable hosts</span>
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

<span class="pl-c"><span class="pl-c">#</span> Kubernetes The Hard Way</span>
XXX.XXX.XXX.XXX server.kubernetes.local server
XXX.XXX.XXX.XXX node-0.kubernetes.local node-0
XXX.XXX.XXX.XXX node-1.kubernetes.local node-1</pre></div>
<p>æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥å¯ä»¥ä½¿ç”¨ä¸»æœºå SSH è®¿é—® <code class="notranslate">machines.txt</code> æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ¯å°æœºå™¨ã€‚</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-k">for</span> <span class="pl-smi">host</span> <span class="pl-k">in</span> server node-0 node-1
<span class="pl-k">do</span> ssh root@<span class="pl-smi">${host}</span> uname -o -m -n
<span class="pl-k">done</span>

server aarch64 GNU/Linux
node-0 aarch64 GNU/Linux
node-1 aarch64 GNU/Linux</pre></div>
<h2>å°† DNS æ¡ç›®æ·»åŠ åˆ°è¿œç¨‹æœºå™¨</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†ä» <code class="notranslate">hosts</code> æ–‡ä»¶é™„åŠ  DNS æ¡ç›®åˆ° <code class="notranslate">machines.txt</code> æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ¯å°æœºå™¨çš„ <code class="notranslate">/etc/hosts</code> æ–‡ä»¶ä¸­ã€‚</p>
<p>å°† <code class="notranslate">hosts</code> æ–‡ä»¶å¤åˆ¶åˆ°æ¯å°æœºå™¨ï¼Œå¹¶å°†å†…å®¹é™„åŠ åˆ° <code class="notranslate">/etc/hosts</code>ï¼š</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-k">while</span> <span class="pl-c1">read</span> IP FQDN HOST SUBNET<span class="pl-k">;</span> <span class="pl-k">do</span>
  scp hosts root@<span class="pl-smi">${HOST}</span>:<span class="pl-k">~</span>/
  ssh -n \
    root@<span class="pl-smi">${HOST}</span> <span class="pl-s"><span class="pl-pds">"</span>cat hosts &gt;&gt; /etc/hosts<span class="pl-pds">"</span></span>
<span class="pl-k">done</span> <span class="pl-k">&lt;</span> machines.txt</pre></div>
<p>æ­¤æ—¶ï¼Œå¯ä»¥åœ¨ <code class="notranslate">jumpbox</code> æœºå™¨æˆ– Kubernetes é›†ç¾¤ä¸­çš„ä»»ä½•ä¸‰å°æœºå™¨ä¹‹é—´ä½¿ç”¨ä¸»æœºåè¿›è¡Œè¿æ¥ã€‚æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ <code class="notranslate">server</code>ã€<code class="notranslate">node-0</code> æˆ– <code class="notranslate">node-1</code> ç­‰ä¸»æœºåè€Œä¸æ˜¯ IP åœ°å€è¿›è¡Œè¿æ¥ã€‚</p></div>
<div style="font-size:small;margin-top:8px;float:right;">ğŸºè½¬è½½æ–‡ç« è¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼ğŸº</div>
<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">è¯„è®º</button>
<div class="comments" id="comments"></div>
</div>
    <div id="footer">Copyright Â© <span id="year"></span><a href="https://blog.witter.top"> V's Blog </a>
<p><a href="https://beian.miit.gov.cn/" target="_blank">å†€ICPå¤‡2022019998å·</a>
<span id="runday"></span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a>
</p>

<script>
if("06/20/2024"!=""){
    var now=new Date();
    var startSite=new Date("06/20/2024");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("year").innerHTML=now.getFullYear();
    if("å†€ICPå¤‡2022019998å·"!=""){document.getElementById("runday").innerHTML=" â€¢ "+"ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";}
    else{document.getElementById("runday").innerHTML="ç½‘ç«™è¿è¡Œ"+diffDay+"å¤©"+" â€¢ ";}
}
</script>
</div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n\n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);

function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","ljwtorch/ljwtorch.github.io");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}
</script>
<script defer src="http://ssh.witter.top:10012/script.js" data-website-id="b891c729-62b4-46cb-bdca-d622dc706106"></script>

</html>
